{"version":3,"file":"RouteLoader-952df30e.js","sources":["../src/app/pages/NotFound.js","../src/app/core/routes/Status.js","../src/app/core/util/ToJs.js","../src/app/core/routes/RouteLoader.js"],"sourcesContent":["import React from 'react';\nconst NotFound = () => (\n  <>\n    <header>\n      <h1>404 Page Not Found</h1>\n    </header>\n  </>\n);\nexport default NotFound;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Route } from 'react-router-dom';\n\nexport const Status = ({ code, children }) => {\n  return (\n    <Route\n      render={({ staticContext }) => {\n        if (staticContext) staticContext.status = code;\n        return children;\n      }}\n    />\n  );\n};\n\nStatus.propTypes = {\n  code: PropTypes.number.isRequired,\n  children: PropTypes.element,\n};\n","import React from 'react';\nimport { Iterable } from 'immutable';\n\nexport const toJS = WrappedComponent => wrappedComponentProps => {\n  const KEY = 0;\n  const VALUE = 1;\n\n  const propsJS = Object.entries(wrappedComponentProps).reduce(\n    (newProps, wrappedComponentProp) => {\n      newProps[wrappedComponentProp[KEY]] = Iterable.isIterable(\n        wrappedComponentProp[VALUE]\n      )\n        ? wrappedComponentProp[VALUE].toJS()\n        : wrappedComponentProp[VALUE];\n      return newProps;\n    },\n    {}\n  );\n\n  return <WrappedComponent {...propsJS} />;\n};\n","import React, { useEffect, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { hot } from 'react-hot-loader';\nimport { Redirect, useLocation } from 'react-router-dom';\nimport { renderRoutes, matchRoutes } from 'react-router-config';\n\nimport {\n  selectCurrentPath,\n  selectCurrentProject,\n  selectIsNotFound,\n  selectMappedEntry,\n  selectRouteEntry,\n  selectRouteEntryContentTypeId,\n  selectRouteLoading,\n} from '~/core/redux/selectors/routing';\nimport { setNavigationPath } from '~/core/redux/actions/routing';\nimport NotFound from '~/pages/NotFound';\n\nimport { Status } from './Status';\nimport { toJS } from '../util/ToJs';\n\nconst getTrimmedPath = path => {\n  if (path !== '/') {\n    const lastChar = path[path.length - 1];\n    if (lastChar == '/') {\n      return path.substring(0, path.length - 1);\n    }\n  }\n  return path;\n};\n\nconst RouteLoader = ({\n  statePath,\n  projectId,\n  contentTypeId,\n  entry,\n  isLoading,\n  isLoggedIn,\n  isNotFound,\n  loadingComponent,\n  mappedEntry,\n  notFoundComponent,\n  setNavigationPath,\n  routes,\n  withEvents,\n}) => {\n  const location = useLocation();\n\n  // Match any Static Routes a developer has defined\n  const matchedStaticRoute = () =>\n    matchRoutes(routes.StaticRoutes, location.pathname);\n  const isStaticRoute = () => matchedStaticRoute().length > 0;\n\n  const trimmedPath = getTrimmedPath(location.pathname);\n\n  const staticRoute = isStaticRoute() && matchedStaticRoute()[0];\n\n  const setPath = useCallback(() => {\n    let serverPath = null;\n    if (staticRoute && staticRoute.match && staticRoute.match.isExact) {\n      serverPath = staticRoute.route.path\n        .split('/')\n        .filter(p => !p.startsWith(':'))\n        .join('/');\n    }\n\n    setNavigationPath(\n      serverPath || trimmedPath,\n      location,\n      staticRoute,\n      withEvents,\n      statePath,\n      routes\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    setNavigationPath,\n    // staticRoute,\n    withEvents,\n    location,\n    routes,\n    // statePath,\n    trimmedPath,\n  ]);\n\n  if (typeof window == 'undefined') setPath();\n\n  useEffect(() => {\n    setPath();\n  }, [location, setPath]);\n\n  // Need to redirect when url endswith a /\n  if (location.pathname.length > trimmedPath.length) {\n    return <Redirect to={trimmedPath} />;\n  }\n  // Render any Static Routes a developer has defined\n  if (isStaticRoute(trimmedPath)) {\n    return renderRoutes(routes.StaticRoutes, {\n      projectId,\n      contentTypeId,\n      entry,\n      mappedEntry,\n      isLoggedIn,\n    });\n  }\n\n  // Render a supplied Loading component if the route\n  // is not a static route and is in a loading state\n  if (isLoading && !isNotFound && loadingComponent) {\n    const LoadingComponent = loadingComponent;\n    return <LoadingComponent />;\n  }\n\n  // Match any defined Content Type Mappings\n  if (contentTypeId) {\n    const MatchedComponent = routes.ContentTypeMappings.find(\n      item => item.contentTypeID == contentTypeId\n    );\n\n    if (MatchedComponent) {\n      return (\n        <MatchedComponent.component\n          projectId={projectId}\n          contentTypeId={contentTypeId}\n          entry={entry}\n          mappedEntry={mappedEntry}\n          isLoggedIn={isLoggedIn}\n        />\n      );\n    }\n  }\n\n  const NotFoundComponent = notFoundComponent ? notFoundComponent : NotFound;\n  if (isNotFound) {\n    return (\n      <Status code={404}>\n        <NotFoundComponent />\n      </Status>\n    );\n  }\n\n  return null;\n};\n\nRouteLoader.propTypes = {\n  contentTypeId: PropTypes.string,\n  entry: PropTypes.object,\n  isLoading: PropTypes.bool,\n  isLoggedIn: PropTypes.bool,\n  isNotFound: PropTypes.bool,\n  loadingComponent: PropTypes.func,\n  mappedEntry: PropTypes.object,\n  notFoundComponent: PropTypes.func,\n  projectId: PropTypes.string,\n  routes: PropTypes.objectOf(PropTypes.array, PropTypes.array),\n  setNavigationPath: PropTypes.func,\n  statePath: PropTypes.string,\n  withEvents: PropTypes.object,\n};\n\nconst mapStateToProps = state => {\n  return {\n    contentTypeId: selectRouteEntryContentTypeId(state),\n    entry: selectRouteEntry(state),\n    isNotFound: selectIsNotFound(state),\n    isLoading: selectRouteLoading(state),\n    mappedEntry: selectMappedEntry(state),\n    projectId: selectCurrentProject(state),\n    statePath: selectCurrentPath(state),\n  };\n};\n\nconst mapDispatchToProps = {\n  setNavigationPath,\n};\n\nexport default hot(module)(\n  connect(\n    mapStateToProps,\n    mapDispatchToProps\n  )(toJS(RouteLoader))\n);\n"],"names":["NotFound","Status","code","children","staticContext","status","propTypes","PropTypes","number","isRequired","element","toJS","WrappedComponent","wrappedComponentProps","KEY","VALUE","propsJS","Object","entries","reduce","newProps","wrappedComponentProp","Iterable","isIterable","getTrimmedPath","path","lastChar","length","substring","RouteLoader","statePath","projectId","contentTypeId","entry","isLoading","isLoggedIn","isNotFound","loadingComponent","mappedEntry","notFoundComponent","setNavigationPath","routes","withEvents","location","useLocation","matchedStaticRoute","matchRoutes","StaticRoutes","pathname","isStaticRoute","trimmedPath","staticRoute","setPath","useCallback","serverPath","match","isExact","route","split","filter","p","startsWith","join","window","useEffect","renderRoutes","LoadingComponent","MatchedComponent","ContentTypeMappings","find","item","contentTypeID","NotFoundComponent","string","object","bool","func","objectOf","array","mapStateToProps","state","selectRouteEntryContentTypeId","selectRouteEntry","selectIsNotFound","selectRouteLoading","selectMappedEntry","selectCurrentProject","selectCurrentPath","mapDispatchToProps","hot","module","connect"],"mappings":"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"}