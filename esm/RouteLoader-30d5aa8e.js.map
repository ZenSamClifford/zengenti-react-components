{"version":3,"file":"RouteLoader-30d5aa8e.js","sources":["../src/routing/components/NotFound.js","../src/routing/components/Status.js","../src/routing/components/RouteLoader.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst NotFound = ({ statusCode, statusText }) => (\n  <>\n    <header>\n      <h1>{statusCode || '404'} Page Not Found</h1>\n      {statusText && (\n        <h2\n          style={{\n            background: '#eee',\n            color: '#666',\n            fontSize: '100%',\n            padding: '10px',\n          }}\n        >\n          {statusText}\n        </h2>\n      )}\n    </header>\n  </>\n);\n\nNotFound.propTypes = {\n  statusCode: PropTypes.number,\n  statusText: PropTypes.string,\n};\n\nexport default NotFound;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Route } from 'react-router-dom';\n\nexport const Status = ({ code, children }) => {\n  return (\n    <Route\n      render={({ staticContext }) => {\n        if (staticContext) staticContext.status = code;\n        return children;\n      }}\n    />\n  );\n};\n\nStatus.propTypes = {\n  code: PropTypes.number.isRequired,\n  children: PropTypes.element,\n};\n","import React, { useEffect, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { hot } from 'react-hot-loader';\nimport { Redirect, useLocation } from 'react-router-dom';\nimport { renderRoutes, matchRoutes } from 'react-router-config';\n\nimport NotFound from './NotFound';\nimport { Status } from './Status';\n\nimport {\n  selectCurrentPath,\n  selectCurrentProject,\n  selectIsNotFound,\n  selectMappedEntry,\n  selectRouteEntry,\n  selectRouteEntryContentTypeId,\n  selectRouteErrorMessage,\n  selectRouteIsError,\n  selectRouteLoading,\n  selectRouteStatusCode,\n} from '../redux/selectors';\nimport { setNavigationPath } from '../redux/actions';\n\nimport {\n  selectUserGroups,\n  selectUserIsAuthenticated,\n} from '~/user/redux/selectors';\nimport { matchUserGroup } from '~/user/util/matchGroups';\n\nimport { toJS } from '~/util/ToJs';\n\nconst getTrimmedPath = path => {\n  if (path !== '/') {\n    const nextPath = path.replace(/\\/\\//, '/');\n    const lastChar = nextPath[nextPath.length - 1];\n    if (lastChar == '/') {\n      return nextPath.substring(0, nextPath.length - 1);\n    }\n  }\n  return path;\n};\n\nconst RouteLoader = ({\n  contentTypeId,\n  entry,\n  isError,\n  isLoading,\n  isLoggedIn,\n  isNotFound,\n  loadingComponent,\n  mappedEntry,\n  notFoundComponent,\n  projectId,\n  routes,\n  setNavigationPath,\n  statePath,\n  statusCode,\n  statusText,\n  userGroups,\n  withEvents,\n}) => {\n  const location = useLocation();\n  // Always ensure paths are trimmed of trailing slashes so urls are always unique\n  const trimmedPath = getTrimmedPath(location.pathname);\n\n  // Match any Static Routes a developer has defined\n  const matchedStaticRoute = () =>\n    matchRoutes(routes.StaticRoutes, location.pathname);\n  const isStaticRoute = () => matchedStaticRoute().length > 0;\n\n  const staticRoute = isStaticRoute() && matchedStaticRoute()[0];\n  const routeRequiresLogin = staticRoute && staticRoute.route.requireLogin;\n\n  const setPath = useCallback(() => {\n    // Use serverPath to control the path we send to siteview node api to resolve a route\n    let serverPath = null;\n    if (staticRoute && staticRoute.match && staticRoute.match.isExact) {\n      const { match, route } = staticRoute;\n\n      if (route.path.includes('*')) {\n        // Send the whole url to api if we have matched route containing wildcard\n        serverPath = match.url;\n      } else if (typeof route.fetchNodeLevel === 'number') {\n        // Send all url parts to a specified level to api\n        serverPath = match.url\n          .split('/')\n          .splice(0, route.fetchNodeLevel + 1)\n          .join('/');\n      } else {\n        // Send all non-parameterised url parts to api\n        serverPath = route.path\n          .split('/')\n          .filter(p => !p.startsWith(':'))\n          .join('/');\n      }\n    }\n\n    setNavigationPath(\n      serverPath || trimmedPath,\n      location,\n      staticRoute,\n      withEvents,\n      statePath,\n      routes\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    setNavigationPath,\n    // staticRoute,\n    withEvents,\n    location,\n    routes,\n    // statePath,\n    trimmedPath,\n  ]);\n\n  if (typeof window == 'undefined') setPath();\n\n  useEffect(() => {\n    setPath();\n  }, [location, setPath]);\n\n  // Need to redirect when url endswith a /\n  if (location.pathname.length > trimmedPath.length) {\n    return <Redirect to={trimmedPath} />;\n  }\n\n  // Render any Static Routes a developer has defined\n  if (isStaticRoute(trimmedPath) && !(!isLoggedIn && routeRequiresLogin)) {\n    if (matchUserGroup(userGroups, routeRequiresLogin))\n      return renderRoutes(routes.StaticRoutes, {\n        projectId,\n        contentTypeId,\n        entry,\n        mappedEntry,\n        isLoggedIn,\n      });\n  }\n\n  // Render a supplied Loading component if the route\n  // is not a static route and is in a loading state\n  if (isLoading && !isNotFound && loadingComponent) {\n    const LoadingComponent = loadingComponent;\n    return <LoadingComponent />;\n  }\n\n  // Match any defined Content Type Mappings\n  if (contentTypeId && !(!isLoggedIn && routeRequiresLogin)) {\n    const MatchedComponent = routes.ContentTypeMappings.find(\n      item => item.contentTypeID == contentTypeId\n    );\n\n    // debugger;\n    if (MatchedComponent && !(MatchedComponent.requireLogin && !isLoggedIn)) {\n      if (matchUserGroup(userGroups, MatchedComponent.requireLogin))\n        return (\n          <MatchedComponent.component\n            projectId={projectId}\n            contentTypeId={contentTypeId}\n            entry={entry}\n            mappedEntry={mappedEntry}\n            isLoggedIn={isLoggedIn}\n          />\n        );\n    }\n  }\n\n  const NotFoundComponent = notFoundComponent ? notFoundComponent : NotFound;\n  if (isNotFound || isError) {\n    return (\n      <Status code={statusCode}>\n        <NotFoundComponent statusCode={statusCode} statusText={statusText} />\n      </Status>\n    );\n  }\n\n  return null;\n};\n\nRouteLoader.propTypes = {\n  contentTypeId: PropTypes.string,\n  entry: PropTypes.object,\n  isError: PropTypes.bool,\n  isLoading: PropTypes.bool,\n  isLoggedIn: PropTypes.bool,\n  isNotFound: PropTypes.bool,\n  loadingComponent: PropTypes.func,\n  mappedEntry: PropTypes.object,\n  notFoundComponent: PropTypes.func,\n  projectId: PropTypes.string,\n  routes: PropTypes.objectOf(PropTypes.array, PropTypes.array),\n  setNavigationPath: PropTypes.func,\n  statePath: PropTypes.string,\n  statusCode: PropTypes.number,\n  statusText: PropTypes.string,\n  userGroups: PropTypes.array,\n  withEvents: PropTypes.object,\n};\n\nconst mapStateToProps = state => {\n  return {\n    contentTypeId: selectRouteEntryContentTypeId(state),\n    entry: selectRouteEntry(state),\n    isError: selectRouteIsError(state),\n    isNotFound: selectIsNotFound(state),\n    isLoading: selectRouteLoading(state),\n    isLoggedIn: selectUserIsAuthenticated(state),\n    mappedEntry: selectMappedEntry(state),\n    projectId: selectCurrentProject(state),\n    statePath: selectCurrentPath(state),\n    statusCode: selectRouteStatusCode(state),\n    statusText: selectRouteErrorMessage(state),\n    userGroups: selectUserGroups(state),\n  };\n};\n\nconst mapDispatchToProps = {\n  setNavigationPath,\n};\n\nexport default hot(module)(\n  connect(mapStateToProps, mapDispatchToProps)(toJS(RouteLoader))\n);\n"],"names":["NotFound","statusCode","statusText","background","color","fontSize","padding","propTypes","PropTypes","number","string","Status","code","children","staticContext","status","isRequired","element","getTrimmedPath","path","nextPath","replace","lastChar","length","substring","RouteLoader","contentTypeId","entry","isError","isLoading","isLoggedIn","isNotFound","loadingComponent","mappedEntry","notFoundComponent","projectId","routes","setNavigationPath","statePath","userGroups","withEvents","location","useLocation","trimmedPath","pathname","matchedStaticRoute","matchRoutes","StaticRoutes","isStaticRoute","staticRoute","routeRequiresLogin","route","requireLogin","setPath","useCallback","serverPath","match","isExact","includes","url","fetchNodeLevel","split","splice","join","filter","p","startsWith","window","useEffect","matchUserGroup","renderRoutes","LoadingComponent","MatchedComponent","ContentTypeMappings","find","item","contentTypeID","NotFoundComponent","object","bool","func","objectOf","array","mapStateToProps","state","selectRouteEntryContentTypeId","selectRouteEntry","selectRouteIsError","selectIsNotFound","selectRouteLoading","selectUserIsAuthenticated","selectMappedEntry","selectCurrentProject","selectCurrentPath","selectRouteStatusCode","selectRouteErrorMessage","selectUserGroups","mapDispatchToProps","hot","module","connect","toJS"],"mappings":"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"}