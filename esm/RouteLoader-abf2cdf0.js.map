{"version":3,"file":"RouteLoader-abf2cdf0.js","sources":["../src/app/pages/NotFound.js","../src/app/core/routes/Status.js","../src/app/core/routes/RouteLoader.js"],"sourcesContent":["import React from 'react';\r\nconst NotFound = () => (\r\n  <>\r\n    <header>\r\n      <h1>404 Page Not Found</h1>\r\n    </header>\r\n  </>\r\n);\r\nexport default NotFound;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Route } from 'react-router-dom';\r\n\r\nexport const Status = ({ code, children }) => {\r\n  return (\r\n    <Route\r\n      render={({ staticContext }) => {\r\n        if (staticContext) staticContext.status = code;\r\n        return children;\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nStatus.propTypes = {\r\n  code: PropTypes.number.isRequired,\r\n  children: PropTypes.element,\r\n};\r\n","import React, { useEffect, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { hot } from 'react-hot-loader';\r\nimport { Redirect, useLocation } from 'react-router-dom';\r\nimport { renderRoutes, matchRoutes } from 'react-router-config';\r\n\r\nimport {\r\n  selectCurrentPath,\r\n  selectCurrentProject,\r\n  selectIsNotFound,\r\n  selectMappedEntry,\r\n  selectRouteEntry,\r\n  selectRouteEntryContentTypeId,\r\n  selectRouteLoading,\r\n} from '~/core/redux/selectors/routing';\r\nimport { setNavigationPath } from '~/core/redux/actions/routing';\r\nimport NotFound from '~/pages/NotFound';\r\n\r\nimport { Status } from './Status';\r\nimport { toJS } from '../util/ToJs';\r\n\r\nconst getTrimmedPath = path => {\r\n  if (path !== '/') {\r\n    const lastChar = path[path.length - 1];\r\n    if (lastChar == '/') {\r\n      return path.substring(0, path.length - 1);\r\n    }\r\n  }\r\n  return path;\r\n};\r\n\r\nconst RouteLoader = ({\r\n  statePath,\r\n  projectId,\r\n  contentTypeId,\r\n  entry,\r\n  isLoading,\r\n  isLoggedIn,\r\n  isNotFound,\r\n  loadingComponent,\r\n  mappedEntry,\r\n  notFoundComponent,\r\n  setNavigationPath,\r\n  routes,\r\n  withEvents,\r\n}) => {\r\n  const location = useLocation();\r\n\r\n  // Match any Static Routes a developer has defined\r\n  const matchedStaticRoute = () =>\r\n    matchRoutes(routes.StaticRoutes, location.pathname);\r\n  const isStaticRoute = () => matchedStaticRoute().length > 0;\r\n\r\n  const trimmedPath = getTrimmedPath(location.pathname);\r\n\r\n  const staticRoute = isStaticRoute() && matchedStaticRoute()[0];\r\n\r\n  const setPath = useCallback(() => {\r\n    let serverPath = null;\r\n    if (staticRoute && staticRoute.match && staticRoute.match.isExact) {\r\n      serverPath = staticRoute.route.path.includes('*')\r\n        ? staticRoute.match.url\r\n        : staticRoute.route.path\r\n            .split('/')\r\n            .filter(p => !p.startsWith(':'))\r\n            .join('/');\r\n    }\r\n\r\n    setNavigationPath(\r\n      serverPath || trimmedPath,\r\n      location,\r\n      staticRoute,\r\n      withEvents,\r\n      statePath,\r\n      routes\r\n    );\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    setNavigationPath,\r\n    // staticRoute,\r\n    withEvents,\r\n    location,\r\n    routes,\r\n    // statePath,\r\n    trimmedPath,\r\n  ]);\r\n\r\n  if (typeof window == 'undefined') setPath();\r\n\r\n  useEffect(() => {\r\n    setPath();\r\n  }, [location, setPath]);\r\n\r\n  // Need to redirect when url endswith a /\r\n  if (location.pathname.length > trimmedPath.length) {\r\n    return <Redirect to={trimmedPath} />;\r\n  }\r\n  // Render any Static Routes a developer has defined\r\n  if (isStaticRoute(trimmedPath)) {\r\n    return renderRoutes(routes.StaticRoutes, {\r\n      projectId,\r\n      contentTypeId,\r\n      entry,\r\n      mappedEntry,\r\n      isLoggedIn,\r\n    });\r\n  }\r\n\r\n  // Render a supplied Loading component if the route\r\n  // is not a static route and is in a loading state\r\n  if (isLoading && !isNotFound && loadingComponent) {\r\n    const LoadingComponent = loadingComponent;\r\n    return <LoadingComponent />;\r\n  }\r\n\r\n  // Match any defined Content Type Mappings\r\n  if (contentTypeId) {\r\n    const MatchedComponent = routes.ContentTypeMappings.find(\r\n      item => item.contentTypeID == contentTypeId\r\n    );\r\n\r\n    if (MatchedComponent) {\r\n      return (\r\n        <MatchedComponent.component\r\n          projectId={projectId}\r\n          contentTypeId={contentTypeId}\r\n          entry={entry}\r\n          mappedEntry={mappedEntry}\r\n          isLoggedIn={isLoggedIn}\r\n        />\r\n      );\r\n    }\r\n  }\r\n\r\n  const NotFoundComponent = notFoundComponent ? notFoundComponent : NotFound;\r\n  if (isNotFound) {\r\n    return (\r\n      <Status code={404}>\r\n        <NotFoundComponent />\r\n      </Status>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nRouteLoader.propTypes = {\r\n  contentTypeId: PropTypes.string,\r\n  entry: PropTypes.object,\r\n  isLoading: PropTypes.bool,\r\n  isLoggedIn: PropTypes.bool,\r\n  isNotFound: PropTypes.bool,\r\n  loadingComponent: PropTypes.func,\r\n  mappedEntry: PropTypes.object,\r\n  notFoundComponent: PropTypes.func,\r\n  projectId: PropTypes.string,\r\n  routes: PropTypes.objectOf(PropTypes.array, PropTypes.array),\r\n  setNavigationPath: PropTypes.func,\r\n  statePath: PropTypes.string,\r\n  withEvents: PropTypes.object,\r\n};\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    contentTypeId: selectRouteEntryContentTypeId(state),\r\n    entry: selectRouteEntry(state),\r\n    isNotFound: selectIsNotFound(state),\r\n    isLoading: selectRouteLoading(state),\r\n    mappedEntry: selectMappedEntry(state),\r\n    projectId: selectCurrentProject(state),\r\n    statePath: selectCurrentPath(state),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  setNavigationPath,\r\n};\r\n\r\nexport default hot(module)(\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )(toJS(RouteLoader))\r\n);\r\n"],"names":["NotFound","Status","code","children","staticContext","status","propTypes","PropTypes","number","isRequired","element","getTrimmedPath","path","lastChar","length","substring","RouteLoader","statePath","projectId","contentTypeId","entry","isLoading","isLoggedIn","isNotFound","loadingComponent","mappedEntry","notFoundComponent","setNavigationPath","routes","withEvents","location","useLocation","matchedStaticRoute","matchRoutes","StaticRoutes","pathname","isStaticRoute","trimmedPath","staticRoute","setPath","useCallback","serverPath","match","isExact","route","includes","url","split","filter","p","startsWith","join","window","useEffect","renderRoutes","LoadingComponent","MatchedComponent","ContentTypeMappings","find","item","contentTypeID","NotFoundComponent","string","object","bool","func","objectOf","array","mapStateToProps","state","selectRouteEntryContentTypeId","selectRouteEntry","selectIsNotFound","selectRouteLoading","selectMappedEntry","selectCurrentProject","selectCurrentPath","mapDispatchToProps","hot","module","connect","toJS"],"mappings":"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"}