{"version":3,"file":"contensis-react-base.js","sources":["../src/server/util/displayStartupConfiguration.js","../src/server/core/reverseProxies.js","../node_modules/fromentries/index.js","../src/server/util/types.js","../src/server/util/handleResponse.js","../src/server/core/webApp.js","../src/server/internalServer.js"],"sourcesContent":["const servers = SERVERS; /* global SERVERS */\nconst projects = PROJECTS; /* global PROJECTS */\n\nconst DisplayStartupConfiguration = config => {\n  /* eslint-disable no-console */\n  console.log();\n  console.log(\n    `Configured servers:\n`,\n    JSON.stringify(servers, null, 2)\n  );\n  console.log();\n  console.log(\n    `Configured projects:\n`,\n    JSON.stringify(projects, null, 2)\n  );\n  console.log();\n  console.log(\n    'Reverse proxy paths: ',\n    JSON.stringify(config.reverseProxyPaths, null, 2)\n  );\n  console.log();\n\n  /* eslint-enable no-console */\n};\n\nexport default DisplayStartupConfiguration;\n","import httpProxy from 'http-proxy';\n\nconst servers = SERVERS; /* global SERVERS */\nexport const apiProxy = httpProxy.createProxyServer();\n\nconst reverseProxies = (app, reverseProxyPaths) => {\n  deliveryApiProxy(apiProxy, app);\n\n  app.all(reverseProxyPaths, (req, res) => {\n    const target =\n      req.hostname.indexOf('preview-') ||\n      req.hostname.indexOf('preview.') ||\n      req.hostname === 'localhost'\n        ? servers.previewIis || servers.iis\n        : servers.iis;\n\n    apiProxy.web(req, res, { target, changeOrigin: true });\n    apiProxy.on('error', e => {\n      /* eslint-disable no-console */\n      console.log(\n        `Proxy Request for ${req.path} HostName:${req.hostname} failed with ${e}`\n      );\n      /* eslint-enable no-console */\n    });\n  });\n};\n\nconst deliveryApiProxy = (apiProxy, app) => {\n  // This is just here to stop cors requests on localhost. In Production this is mapped using varnish.\n  app.all(['/api/delivery/*', '/api/image/*'], (req, res) => {\n    /* eslint-disable no-console */\n    const target = servers.cms;\n    console.log(`Proxying api request to ${servers.alias}`);\n    apiProxy.web(req, res, {\n      target,\n      changeOrigin: true,\n    });\n    apiProxy.on('error', e => {\n      /* eslint-disable no-console */\n      console.log(\n        `Proxy request for ${req.path} HostName:${req.hostname} failed with ${e}`\n      );\n      /* eslint-enable no-console */\n    });\n  });\n};\n\nexport default reverseProxies;\n","/*! fromentries. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */\nmodule.exports = function fromEntries (iterable) {\n  return [...iterable].reduce((obj, [key, val]) => {\n    obj[key] = val\n    return obj\n  }, {})\n}\n","export const ResponseMethod = {\n  send: 'send',\n  json: 'json',\n  end: 'end',\n};\n","/* eslint-disable no-console */\nimport { ResponseMethod } from './types';\n\n/**\n * Web Application Response handler, sends a prepared express js response\n * with the supplied content sending in the specified manner\n * @param {response} request express js request object\n * @param {response} response express js response object\n * @param {string | object} content the content to send in the response body\n * @param {function} send the response function to call e.g res.send() res.json() res.end()\n */\nconst handleResponse = (\n  request,\n  response,\n  content,\n  send = ResponseMethod.send\n) => {\n  // console.log('---', response.statusCode, '---');\n  response[send](content);\n};\n\nexport default handleResponse;\n","import fs from 'fs';\nimport React from 'react';\nimport { StaticRouter } from 'react-router-dom';\nimport { Provider as ReduxProvider } from 'react-redux';\nimport Loadable from 'react-loadable';\nimport { renderToString } from 'react-dom/server';\nimport { getBundles } from 'react-loadable/webpack';\nimport { ServerStyleSheet } from 'styled-components';\nimport Helmet from 'react-helmet';\nimport serialize from 'serialize-javascript';\nimport minifyCssString from 'minify-css-string';\n// import { fromJS } from 'immutable';\nimport fromJSLeaveImmer from '~/core/util/fromJSLeaveImmer';\nimport fromEntries from 'fromentries';\n\nimport { history } from '~/core/redux/history';\n\nimport handleResponse from '../util/handleResponse';\n\nimport pickProject from '~/core/util/pickProject';\nimport { deliveryApi } from '~/core/util/ContensisDeliveryApi';\n\nimport { setCurrentProject } from '~/core/redux/actions/routing';\nimport { setVersion, setVersionStatus } from '~/core/redux/actions/version';\n\nimport {\n  selectCurrentProject,\n  selectRouteEntry,\n} from '~/core/redux/selectors/routing';\n\nimport createStore from '~/core/redux/store';\nimport rootSaga from '~/core/redux/sagas/index.js';\nimport { matchRoutes } from 'react-router-config';\nimport mapJson from 'jsonpath-mapper';\n\nconst addStandardHeaders = (state, response, packagejson, groups) => {\n  if (state) {\n    /* eslint-disable no-console */\n    try {\n      console.log('About to add headers');\n      const routingSurrogateKeys = state.getIn(\n        ['routing', 'surrogateKeys'],\n        ''\n      );\n\n      const surrogateKeyHeader = ` ${packagejson.name}-app ${routingSurrogateKeys}`;\n\n      response.header('surrogate-key', surrogateKeyHeader);\n\n      addVarnishAuthenticationHeaders(state, response, groups);\n\n      response.setHeader('Surrogate-Control', 'max-age=3600');\n    } catch (e) {\n      console.log('Error Adding headers', e.message);\n      // console.log(e);\n    }\n    /* eslint-enable no-console */\n  }\n};\n\nconst addVarnishAuthenticationHeaders = (state, response, groups = {}) => {\n  if (state) {\n    try {\n      const stateEntry = selectRouteEntry(state);\n      const project = selectCurrentProject(state);\n      const { globalGroups, allowedGroups } = groups;\n      // console.log(globalGroups, allowedGroups);\n      let allGroups = Array.from((globalGroups && globalGroups[project]) || {});\n      if (\n        stateEntry &&\n        stateEntry.getIn(['authentication', 'isLoginRequired']) &&\n        allowedGroups &&\n        allowedGroups[project]\n      ) {\n        allGroups = [...allGroups, ...allowedGroups[project]];\n      }\n      response.header('x-contensis-viewer-groups', allGroups.join('|'));\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.log('Error adding authentication header', e);\n    }\n  }\n};\n\nconst readFileSync = path => fs.readFileSync(path, 'utf8');\n\nconst loadBundleData = ({ stats, templates }, build) => {\n  const bundle = {};\n  try {\n    bundle.stats = JSON.parse(\n      readFileSync(stats.replace('/target', build ? `/${build}` : ''))\n    );\n  } catch (ex) {\n    //console.log(ex);\n    bundle.stats = null;\n  }\n  try {\n    bundle.templates = {\n      templateHTML: readFileSync(\n        templates.html.replace('/target', build ? `/${build}` : '')\n      ),\n      templateHTMLStatic: readFileSync(\n        templates.static.replace('/target', build ? `/${build}` : '')\n      ),\n      templateHTMLFragment: readFileSync(\n        templates.fragment.replace('/target', build ? `/${build}` : '')\n      ),\n    };\n  } catch (ex) {\n    //console.log(ex);\n    bundle.templates = null;\n  }\n  return bundle;\n};\n\nconst webApp = (app, ReactApp, config) => {\n  const {\n    routes,\n    withReducers,\n    withSagas,\n    withEvents,\n    packagejson,\n    staticFolderPath = 'static',\n    startupScriptFilename,\n    differentialBundles,\n    allowedGroups,\n    globalGroups,\n    disableSsrRedux,\n    handleResponses,\n  } = config;\n\n  const bundleData = {\n    default: loadBundleData(config),\n    legacy: loadBundleData(config, 'legacy'),\n    modern: loadBundleData(config, 'modern'),\n  };\n  if (!bundleData.default || bundleData.default === {})\n    bundleData.default = bundleData.legacy || bundleData.modern;\n\n  const versionInfo = JSON.parse(\n    fs.readFileSync(`dist/${staticFolderPath}/version.json`, 'utf8')\n  );\n\n  const responseHandler =\n    typeof handleResponses === 'function' ? handleResponses : handleResponse;\n\n  app.get('/*', (request, response, next) => {\n    if (request.originalUrl.startsWith(`/${staticFolderPath}/`)) return next();\n\n    const { url } = request;\n\n    const matchedStaticRoute = () =>\n      matchRoutes(routes.StaticRoutes, request.path);\n    const isStaticRoute = () => matchedStaticRoute().length > 0;\n    const staticRoute = isStaticRoute() && matchedStaticRoute()[0];\n\n    // Allow certain routes to avoid SSR\n    const onlyDynamic = staticRoute && staticRoute.route.ssr === false;\n\n    const normaliseQs = q => (q && q.toLowerCase() === 'true' ? true : false);\n\n    // Determine functional params from QueryString and set access methods\n    const accessMethod = mapJson(request.query, {\n      DYNAMIC: ({ dynamic }) => normaliseQs(dynamic) || onlyDynamic,\n      REDUX: ({ redux }) => normaliseQs(redux),\n      FRAGMENT: ({ fragment }) => normaliseQs(fragment),\n      STATIC: ({ static: value }) => normaliseQs(value),\n    });\n\n    const context = {};\n    let status = 200;\n\n    // Create a store (with a memory history) from our current url\n    const store = createStore(\n      withReducers,\n      fromJSLeaveImmer({}),\n      history({\n        initialEntries: [url],\n      })\n    );\n\n    // dispatch any global and non-saga related actions before calling our JSX\n    const versionStatusFromHostname = deliveryApi.getVersionStatusFromHostname(\n      request.hostname\n    );\n\n    // eslint-disable-next-line no-console\n    console.log(\n      `Request for ${request.path} hostname: ${request.hostname} versionStatus: ${versionStatusFromHostname}`\n    );\n\n    store.dispatch(\n      setVersionStatus(request.query.versionStatus || versionStatusFromHostname)\n    );\n    store.dispatch(setVersion(versionInfo.commitRef, versionInfo.buildNo));\n\n    const project = pickProject(request.hostname, request.query);\n\n    const groups = allowedGroups && allowedGroups[project];\n    store.dispatch(setCurrentProject(project, groups));\n\n    const modules = [];\n\n    const jsx = (\n      <Loadable.Capture report={moduleName => modules.push(moduleName)}>\n        <ReduxProvider store={store}>\n          <StaticRouter context={context} location={url}>\n            <ReactApp routes={routes} withEvents={withEvents} />\n          </StaticRouter>\n        </ReduxProvider>\n      </Loadable.Capture>\n    );\n\n    const buildBundleTags = bundles => {\n      // Take the bundles returned from Loadable.Capture\n      const bundleTags = bundles\n        .map(bundle => {\n          if (bundle.publicPath.includes('/modern/'))\n            return differentialBundles\n              ? `<script type=\"module\" src=\"${bundle.publicPath}\"></script>`\n              : null;\n          return `<script nomodule src=\"${bundle.publicPath}\"></script>`;\n        })\n        .filter(f => f);\n\n      // Add the static startup script to the bundleTags\n      startupScriptFilename &&\n        bundleTags.push(\n          `<script src=\"/${staticFolderPath}/${startupScriptFilename}\"></script>`\n        );\n\n      return bundleTags;\n    };\n\n    const templates =\n      bundleData.default.templates || bundleData.legacy.templates;\n\n    const stats =\n      bundleData.modern.stats && bundleData.legacy.stats\n        ? fromEntries(\n            Object.entries(bundleData.modern.stats).map(([lib, paths]) => [\n              lib,\n              bundleData.legacy.stats[lib]\n                ? [...paths, ...bundleData.legacy.stats[lib]]\n                : paths,\n            ])\n          )\n        : bundleData.default.stats;\n\n    const {\n      templateHTML,\n      templateHTMLFragment,\n      templateHTMLStatic,\n    } = templates;\n\n    // Serve a blank HTML page with client scripts to load the app in the browser\n    if (accessMethod.DYNAMIC) {\n      // Dynamic doesn't need sagas\n      renderToString(jsx);\n\n      // Dynamic page render has only the necessary bundles to start up the app\n      // and does not include any react-loadable code-split bundles\n      const loadableBundles = getBundles(stats, modules);\n      const bundleTags = buildBundleTags(loadableBundles).join('');\n\n      const isDynamicHint = `<script>window.isDynamic = true;</script>`;\n\n      const responseHtmlDynamic = templateHTML\n        .replace('{{TITLE}}', '')\n        .replace('{{SEO_CRITICAL_METADATA}}', '')\n        .replace('{{CRITICAL_CSS}}', '')\n        .replace('{{APP}}', '')\n        .replace('{{LOADABLE_CHUNKS}}', bundleTags)\n        .replace('{{REDUX_DATA}}', isDynamicHint);\n      response.setHeader('Surrogate-Control', 'max-age=3600');\n      response.status(status); //.send(responseHtmlDynamic);\n      responseHandler(request, response, responseHtmlDynamic);\n    }\n\n    // Render the JSX server side and send response as per access method options\n    if (!accessMethod.DYNAMIC) {\n      store\n        .runSaga(rootSaga(withSagas))\n        .toPromise()\n        .then(() => {\n          const sheet = new ServerStyleSheet();\n\n          const html = renderToString(sheet.collectStyles(jsx));\n\n          const helmet = Helmet.renderStatic();\n          Helmet.rewind();\n          const htmlAttributes = helmet.htmlAttributes.toString();\n          let title = helmet.title.toString();\n          const metadata = helmet.meta.toString();\n\n          if (context.status === 404) {\n            status = 404;\n            title = '<title>404 page not found</title>';\n          }\n\n          if (context.url) {\n            return response.redirect(302, context.url);\n          }\n\n          const reduxState = store.getState();\n\n          const styleTags = sheet.getStyleTags();\n\n          // After running rootSaga there should be an additional react-loadable\n          // code-split bundle for a page component as well as core app bundles\n          const loadableBundles = getBundles(stats, modules);\n          const bundleTags = buildBundleTags(loadableBundles).join('');\n\n          let serialisedReduxData = '';\n          if (context.status !== 404) {\n            // For a request that returns a redux state object as a response\n            if (accessMethod.REDUX) {\n              serialisedReduxData = serialize(reduxState, {\n                ignoreFunction: true,\n              });\n              addStandardHeaders(reduxState, response, packagejson, {\n                allowedGroups,\n                globalGroups,\n              });\n              response.status(status); //.json(serialisedReduxData);\n              responseHandler(request, response, serialisedReduxData, 'json');\n              return true;\n            }\n            if (!disableSsrRedux) {\n              serialisedReduxData = serialize(reduxState, {\n                ignoreFunction: true,\n              });\n              serialisedReduxData = `<script>window.REDUX_DATA = ${serialisedReduxData}</script>`;\n            }\n          }\n          if (context.status === 404) {\n            accessMethod.STATIC = true;\n          }\n\n          // Responses\n          let responseHTML = '';\n\n          // Static page served as a fragment\n          if (accessMethod.FRAGMENT && accessMethod.STATIC) {\n            addStandardHeaders(reduxState, response, packagejson, {\n              allowedGroups,\n              globalGroups,\n            });\n            responseHTML = minifyCssString(styleTags) + html;\n          }\n\n          // Page fragment served with client scripts and redux data that hydrate the app client side\n          if (accessMethod.FRAGMENT && !accessMethod.STATIC) {\n            responseHTML = templateHTMLFragment\n              .replace('{{TITLE}}', title)\n              .replace('{{SEO_CRITICAL_METADATA}}', metadata)\n              .replace('{{CRITICAL_CSS}}', minifyCssString(styleTags))\n              .replace('{{APP}}', html)\n              .replace('{{LOADABLE_CHUNKS}}', bundleTags)\n              .replace('{{REDUX_DATA}}', serialisedReduxData);\n          }\n\n          // Full HTML page served statically\n          if (!accessMethod.FRAGMENT && accessMethod.STATIC) {\n            responseHTML = templateHTMLStatic\n              .replace('{{TITLE}}', title)\n              .replace('{{SEO_CRITICAL_METADATA}}', metadata)\n              .replace('{{CRITICAL_CSS}}', minifyCssString(styleTags))\n              .replace('{{APP}}', html)\n              .replace('{{LOADABLE_CHUNKS}}', '');\n          }\n\n          // Full HTML page served with client scripts and redux data that hydrate the app client side\n          if (!accessMethod.FRAGMENT && !accessMethod.STATIC) {\n            responseHTML = templateHTML\n              .replace('{{TITLE}}', title)\n              .replace('{{SEO_CRITICAL_METADATA}}', metadata)\n              .replace('{{CRITICAL_CSS}}', styleTags)\n              .replace('{{APP}}', html)\n              .replace('{{LOADABLE_CHUNKS}}', bundleTags)\n              .replace('{{REDUX_DATA}}', serialisedReduxData);\n          }\n          addStandardHeaders(reduxState, response, packagejson, {\n            allowedGroups,\n            globalGroups,\n          });\n          try {\n            // If react-helmet htmlAttributes are being used, replace the html tag with those attributes sepcified e.g (lang, dir etc.)\n            if (htmlAttributes) {\n              responseHTML = responseHTML.replace(\n                /<html?.+?>/,\n                `<html ${htmlAttributes}>`\n              );\n            }\n            response.status(status); //.send(responseHTML);\n            responseHandler(request, response, responseHTML);\n          } catch (err) {\n            // eslint-disable-next-line no-console\n            console.log(err.message);\n          }\n        })\n        .catch(err => {\n          // Handle any error that occurred in any of the previous\n          // promises in the chain.\n          // eslint-disable-next-line no-console\n          console.log(err);\n          response.status(500);\n          responseHandler(\n            request,\n            response,\n            `Error occurred: <br />${err.stack} <br />${JSON.stringify(err)}`\n          );\n          // .send(\n          //   `Error occurred: <br />${err.stack} <br />${JSON.stringify(err)}`\n          // );\n        });\n      renderToString(jsx);\n\n      store.close();\n    }\n  });\n};\n\nexport default webApp;\n","import 'isomorphic-fetch';\nimport express from 'express';\nimport Loadable from 'react-loadable';\n\nimport DisplayStartupConfiguration from './util/displayStartupConfiguration';\nimport ConfigureReverseProxies, { apiProxy } from './core/reverseProxies';\nimport ConfigureWebApp from './core/webApp';\n\nconst app = express();\n\nconst start = (ReactApp, config, ServerFeatures) => {\n  const { staticFolderPath = 'static' } = config;\n\n  app.disable('x-powered-by');\n\n  // Output some information about the used build/startup configuration\n  DisplayStartupConfiguration(config);\n\n  // Set-up local proxy for images from cms, to save doing rewrites and extra code\n  ServerFeatures(app);\n  ConfigureReverseProxies(app, config.reverseProxyPaths);\n  ConfigureWebApp(app, ReactApp, config);\n\n  app.use(\n    `/${staticFolderPath}`,\n    express.static(`dist/${staticFolderPath}`, { maxage: '31557600h' })\n  );\n\n  app.on('ready', async () => {\n    // Configure DNS to make life easier\n    //await ConfigureLocalDNS();\n\n    Loadable.preloadAll().then(() => {\n      var server = app.listen(3001, () => {\n        console.info(`HTTP server is listening @ port 3001`);\n        setTimeout(function() {\n          app.emit('app_started');\n        }, 500);\n      });\n      app.on('stop', () => {\n        server.close(function() {\n          console.info('GoodBye :(');\n        });\n      });\n    });\n  });\n};\n\nexport default { app, apiProxy, start };\n"],"names":["servers","SERVERS","projects","PROJECTS","DisplayStartupConfiguration","config","console","log","JSON","stringify","reverseProxyPaths","apiProxy","httpProxy","createProxyServer","reverseProxies","app","deliveryApiProxy","all","req","res","target","hostname","indexOf","previewIis","iis","web","changeOrigin","on","e","path","cms","alias","ResponseMethod","send","json","end","handleResponse","request","response","content","addStandardHeaders","state","packagejson","groups","routingSurrogateKeys","getIn","surrogateKeyHeader","name","header","addVarnishAuthenticationHeaders","setHeader","message","stateEntry","selectRouteEntry","project","selectCurrentProject","globalGroups","allowedGroups","allGroups","Array","from","join","readFileSync","fs","loadBundleData","stats","templates","build","bundle","parse","replace","ex","templateHTML","html","templateHTMLStatic","static","templateHTMLFragment","fragment","webApp","ReactApp","routes","withReducers","withSagas","withEvents","staticFolderPath","startupScriptFilename","differentialBundles","disableSsrRedux","handleResponses","bundleData","default","legacy","modern","versionInfo","responseHandler","get","next","originalUrl","startsWith","url","matchedStaticRoute","matchRoutes","StaticRoutes","isStaticRoute","length","staticRoute","onlyDynamic","route","ssr","normaliseQs","q","toLowerCase","accessMethod","mapJson","query","DYNAMIC","dynamic","REDUX","redux","FRAGMENT","STATIC","value","context","status","store","createStore","fromJSLeaveImmer","history","initialEntries","versionStatusFromHostname","deliveryApi","getVersionStatusFromHostname","dispatch","setVersionStatus","versionStatus","setVersion","commitRef","buildNo","pickProject","setCurrentProject","modules","jsx","React","Loadable","moduleName","push","ReduxProvider","StaticRouter","buildBundleTags","bundles","bundleTags","map","publicPath","includes","filter","f","fromEntries","Object","entries","lib","paths","renderToString","loadableBundles","getBundles","isDynamicHint","responseHtmlDynamic","runSaga","rootSaga","toPromise","then","sheet","ServerStyleSheet","collectStyles","helmet","Helmet","renderStatic","rewind","htmlAttributes","toString","title","metadata","meta","redirect","reduxState","getState","styleTags","getStyleTags","serialisedReduxData","serialize","ignoreFunction","responseHTML","minifyCssString","err","catch","stack","close","express","start","ServerFeatures","disable","ConfigureReverseProxies","ConfigureWebApp","use","maxage","preloadAll","server","listen","info","setTimeout","emit"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAMA,OAAO,GAAGC,OAAhB;AAAyB;;AACzB,MAAMC,QAAQ,GAAGC,QAAjB;AAA2B;;AAE3B,MAAMC,2BAA2B,GAAGC,MAAM,IAAI;AAC5C;AACAC,EAAAA,OAAO,CAACC,GAAR;AACAD,EAAAA,OAAO,CAACC,GAAR,CACG;CADH,EAGEC,IAAI,CAACC,SAAL,CAAeT,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAHF;AAKAM,EAAAA,OAAO,CAACC,GAAR;AACAD,EAAAA,OAAO,CAACC,GAAR,CACG;CADH,EAGEC,IAAI,CAACC,SAAL,CAAeP,QAAf,EAAyB,IAAzB,EAA+B,CAA/B,CAHF;AAKAI,EAAAA,OAAO,CAACC,GAAR;AACAD,EAAAA,OAAO,CAACC,GAAR,CACE,uBADF,EAEEC,IAAI,CAACC,SAAL,CAAeJ,MAAM,CAACK,iBAAtB,EAAyC,IAAzC,EAA+C,CAA/C,CAFF;AAIAJ,EAAAA,OAAO,CAACC,GAAR;AAEA;AACD,CAtBD;;ACDA,MAAMP,SAAO,GAAGC,OAAhB;AAAyB;;AAClB,MAAMU,QAAQ,GAAGC,6BAAS,CAACC,iBAAV,EAAjB;;AAEP,MAAMC,cAAc,GAAG,CAACC,GAAD,EAAML,iBAAN,KAA4B;AACjDM,EAAAA,gBAAgB,CAACL,QAAD,EAAWI,GAAX,CAAhB;AAEAA,EAAAA,GAAG,CAACE,GAAJ,CAAQP,iBAAR,EAA2B,CAACQ,GAAD,EAAMC,GAAN,KAAc;AACvC,UAAMC,MAAM,GACVF,GAAG,CAACG,QAAJ,CAAaC,OAAb,CAAqB,UAArB,KACAJ,GAAG,CAACG,QAAJ,CAAaC,OAAb,CAAqB,UAArB,CADA,IAEAJ,GAAG,CAACG,QAAJ,KAAiB,WAFjB,GAGIrB,SAAO,CAACuB,UAAR,IAAsBvB,SAAO,CAACwB,GAHlC,GAIIxB,SAAO,CAACwB,GALd;AAOAb,IAAAA,QAAQ,CAACc,GAAT,CAAaP,GAAb,EAAkBC,GAAlB,EAAuB;AAAEC,MAAAA,MAAF;AAAUM,MAAAA,YAAY,EAAE;AAAxB,KAAvB;AACAf,IAAAA,QAAQ,CAACgB,EAAT,CAAY,OAAZ,EAAqBC,CAAC,IAAI;AACxB;AACAtB,MAAAA,OAAO,CAACC,GAAR,CACG,qBAAoBW,GAAG,CAACW,IAAK,aAAYX,GAAG,CAACG,QAAS,gBAAeO,CAAE,EAD1E;AAGA;AACD,KAND;AAOD,GAhBD;AAiBD,CApBD;;AAsBA,MAAMZ,gBAAgB,GAAG,CAACL,QAAD,EAAWI,GAAX,KAAmB;AAC1C;AACAA,EAAAA,GAAG,CAACE,GAAJ,CAAQ,CAAC,iBAAD,EAAoB,cAApB,CAAR,EAA6C,CAACC,GAAD,EAAMC,GAAN,KAAc;AACzD;AACA,UAAMC,MAAM,GAAGpB,SAAO,CAAC8B,GAAvB;AACAxB,IAAAA,OAAO,CAACC,GAAR,CAAa,2BAA0BP,SAAO,CAAC+B,KAAM,EAArD;AACApB,IAAAA,QAAQ,CAACc,GAAT,CAAaP,GAAb,EAAkBC,GAAlB,EAAuB;AACrBC,MAAAA,MADqB;AAErBM,MAAAA,YAAY,EAAE;AAFO,KAAvB;AAIAf,IAAAA,QAAQ,CAACgB,EAAT,CAAY,OAAZ,EAAqBC,CAAC,IAAI;AACxB;AACAtB,MAAAA,OAAO,CAACC,GAAR,CACG,qBAAoBW,GAAG,CAACW,IAAK,aAAYX,GAAG,CAACG,QAAS,gBAAeO,CAAE,EAD1E;AAGA;AACD,KAND;AAOD,GAfD;AAgBD,CAlBD;;AC3BA;AACA,eAAc,GAAG,SAAS,WAAW,EAAE,QAAQ,EAAE;AACjD,EAAE,OAAO,CAAC,GAAG,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,KAAK;AACnD,IAAI,GAAG,CAAC,GAAG,CAAC,GAAG,IAAG;AAClB,IAAI,OAAO,GAAG;AACd,GAAG,EAAE,EAAE,CAAC;AACR;;ACNO,MAAMI,cAAc,GAAG;AAC5BC,EAAAA,IAAI,EAAE,MADsB;AAE5BC,EAAAA,IAAI,EAAE,MAFsB;AAG5BC,EAAAA,GAAG,EAAE;AAHuB,CAAvB;;ACAP;AAGA;;;;;;;;;AAQA,MAAMC,cAAc,GAAG,CACrBC,OADqB,EAErBC,QAFqB,EAGrBC,OAHqB,EAIrBN,IAAI,GAAGD,cAAc,CAACC,IAJD,KAKlB;AACH;AACAK,EAAAA,QAAQ,CAACL,IAAD,CAAR,CAAeM,OAAf;AACD,CARD;;ACwBA,MAAMC,kBAAkB,GAAG,CAACC,KAAD,EAAQH,QAAR,EAAkBI,WAAlB,EAA+BC,MAA/B,KAA0C;AACnE,MAAIF,KAAJ,EAAW;AACT;AACA,QAAI;AACFnC,MAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACA,YAAMqC,oBAAoB,GAAGH,KAAK,CAACI,KAAN,CAC3B,CAAC,SAAD,EAAY,eAAZ,CAD2B,EAE3B,EAF2B,CAA7B;AAKA,YAAMC,kBAAkB,GAAI,IAAGJ,WAAW,CAACK,IAAK,QAAOH,oBAAqB,EAA5E;AAEAN,MAAAA,QAAQ,CAACU,MAAT,CAAgB,eAAhB,EAAiCF,kBAAjC;AAEAG,MAAAA,+BAA+B,CAACR,KAAD,EAAQH,QAAR,EAAkBK,MAAlB,CAA/B;AAEAL,MAAAA,QAAQ,CAACY,SAAT,CAAmB,mBAAnB,EAAwC,cAAxC;AACD,KAdD,CAcE,OAAOtB,CAAP,EAAU;AACVtB,MAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAoCqB,CAAC,CAACuB,OAAtC,EADU;AAGX;AACD;;AACD;AACF,CAvBD;;AAyBA,MAAMF,+BAA+B,GAAG,CAACR,KAAD,EAAQH,QAAR,EAAkBK,MAAM,GAAG,EAA3B,KAAkC;AACxE,MAAIF,KAAJ,EAAW;AACT,QAAI;AACF,YAAMW,UAAU,GAAGC,wBAAgB,CAACZ,KAAD,CAAnC;AACA,YAAMa,OAAO,GAAGC,4BAAoB,CAACd,KAAD,CAApC;AACA,YAAM;AAAEe,QAAAA,YAAF;AAAgBC,QAAAA;AAAhB,UAAkCd,MAAxC,CAHE;;AAKF,UAAIe,SAAS,GAAGC,KAAK,CAACC,IAAN,CAAYJ,YAAY,IAAIA,YAAY,CAACF,OAAD,CAA7B,IAA2C,EAAtD,CAAhB;;AACA,UACEF,UAAU,IACVA,UAAU,CAACP,KAAX,CAAiB,CAAC,gBAAD,EAAmB,iBAAnB,CAAjB,CADA,IAEAY,aAFA,IAGAA,aAAa,CAACH,OAAD,CAJf,EAKE;AACAI,QAAAA,SAAS,GAAG,CAAC,GAAGA,SAAJ,EAAe,GAAGD,aAAa,CAACH,OAAD,CAA/B,CAAZ;AACD;;AACDhB,MAAAA,QAAQ,CAACU,MAAT,CAAgB,2BAAhB,EAA6CU,SAAS,CAACG,IAAV,CAAe,GAAf,CAA7C;AACD,KAfD,CAeE,OAAOjC,CAAP,EAAU;AACV;AACAtB,MAAAA,OAAO,CAACC,GAAR,CAAY,oCAAZ,EAAkDqB,CAAlD;AACD;AACF;AACF,CAtBD;;AAwBA,MAAMkC,YAAY,GAAGjC,IAAI,IAAIkC,sBAAE,CAACD,YAAH,CAAgBjC,IAAhB,EAAsB,MAAtB,CAA7B;;AAEA,MAAMmC,cAAc,GAAG,CAAC;AAAEC,EAAAA,KAAF;AAASC,EAAAA;AAAT,CAAD,EAAuBC,KAAvB,KAAiC;AACtD,QAAMC,MAAM,GAAG,EAAf;;AACA,MAAI;AACFA,IAAAA,MAAM,CAACH,KAAP,GAAezD,IAAI,CAAC6D,KAAL,CACbP,YAAY,CAACG,KAAK,CAACK,OAAN,CAAc,SAAd,EAAyBH,KAAK,GAAI,IAAGA,KAAM,EAAb,GAAiB,EAA/C,CAAD,CADC,CAAf;AAGD,GAJD,CAIE,OAAOI,EAAP,EAAW;AACX;AACAH,IAAAA,MAAM,CAACH,KAAP,GAAe,IAAf;AACD;;AACD,MAAI;AACFG,IAAAA,MAAM,CAACF,SAAP,GAAmB;AACjBM,MAAAA,YAAY,EAAEV,YAAY,CACxBI,SAAS,CAACO,IAAV,CAAeH,OAAf,CAAuB,SAAvB,EAAkCH,KAAK,GAAI,IAAGA,KAAM,EAAb,GAAiB,EAAxD,CADwB,CADT;AAIjBO,MAAAA,kBAAkB,EAAEZ,YAAY,CAC9BI,SAAS,CAACS,MAAV,CAAiBL,OAAjB,CAAyB,SAAzB,EAAoCH,KAAK,GAAI,IAAGA,KAAM,EAAb,GAAiB,EAA1D,CAD8B,CAJf;AAOjBS,MAAAA,oBAAoB,EAAEd,YAAY,CAChCI,SAAS,CAACW,QAAV,CAAmBP,OAAnB,CAA2B,SAA3B,EAAsCH,KAAK,GAAI,IAAGA,KAAM,EAAb,GAAiB,EAA5D,CADgC;AAPjB,KAAnB;AAWD,GAZD,CAYE,OAAOI,EAAP,EAAW;AACX;AACAH,IAAAA,MAAM,CAACF,SAAP,GAAmB,IAAnB;AACD;;AACD,SAAOE,MAAP;AACD,CA3BD;;AA6BA,MAAMU,MAAM,GAAG,CAAC/D,GAAD,EAAMgE,QAAN,EAAgB1E,MAAhB,KAA2B;AACxC,QAAM;AACJ2E,IAAAA,MADI;AAEJC,IAAAA,YAFI;AAGJC,IAAAA,SAHI;AAIJC,IAAAA,UAJI;AAKJzC,IAAAA,WALI;AAMJ0C,IAAAA,gBAAgB,GAAG,QANf;AAOJC,IAAAA,qBAPI;AAQJC,IAAAA,mBARI;AASJ7B,IAAAA,aATI;AAUJD,IAAAA,YAVI;AAWJ+B,IAAAA,eAXI;AAYJC,IAAAA;AAZI,MAaFnF,MAbJ;AAeA,QAAMoF,UAAU,GAAG;AACjBC,IAAAA,OAAO,EAAE1B,cAAc,CAAC3D,MAAD,CADN;AAEjBsF,IAAAA,MAAM,EAAE3B,cAAc,CAAC3D,MAAD,EAAS,QAAT,CAFL;AAGjBuF,IAAAA,MAAM,EAAE5B,cAAc,CAAC3D,MAAD,EAAS,QAAT;AAHL,GAAnB;AAKA,MAAI,CAACoF,UAAU,CAACC,OAAZ,IAAuBD,UAAU,CAACC,OAAX,KAAuB,EAAlD,EACED,UAAU,CAACC,OAAX,GAAqBD,UAAU,CAACE,MAAX,IAAqBF,UAAU,CAACG,MAArD;AAEF,QAAMC,WAAW,GAAGrF,IAAI,CAAC6D,KAAL,CAClBN,sBAAE,CAACD,YAAH,CAAiB,QAAOsB,gBAAiB,eAAzC,EAAyD,MAAzD,CADkB,CAApB;AAIA,QAAMU,eAAe,GACnB,OAAON,eAAP,KAA2B,UAA3B,GAAwCA,eAAxC,GAA0DpD,cAD5D;AAGArB,EAAAA,GAAG,CAACgF,GAAJ,CAAQ,IAAR,EAAc,CAAC1D,OAAD,EAAUC,QAAV,EAAoB0D,IAApB,KAA6B;AACzC,QAAI3D,OAAO,CAAC4D,WAAR,CAAoBC,UAApB,CAAgC,IAAGd,gBAAiB,GAApD,CAAJ,EAA6D,OAAOY,IAAI,EAAX;AAE7D,UAAM;AAAEG,MAAAA;AAAF,QAAU9D,OAAhB;;AAEA,UAAM+D,kBAAkB,GAAG,MACzBC,6BAAW,CAACrB,MAAM,CAACsB,YAAR,EAAsBjE,OAAO,CAACR,IAA9B,CADb;;AAEA,UAAM0E,aAAa,GAAG,MAAMH,kBAAkB,GAAGI,MAArB,GAA8B,CAA1D;;AACA,UAAMC,WAAW,GAAGF,aAAa,MAAMH,kBAAkB,GAAG,CAAH,CAAzD,CARyC;;AAWzC,UAAMM,WAAW,GAAGD,WAAW,IAAIA,WAAW,CAACE,KAAZ,CAAkBC,GAAlB,KAA0B,KAA7D;;AAEA,UAAMC,WAAW,GAAGC,CAAC,IAAKA,CAAC,IAAIA,CAAC,CAACC,WAAF,OAAoB,MAAzB,GAAkC,IAAlC,GAAyC,KAAnE,CAbyC;;;AAgBzC,UAAMC,YAAY,GAAGC,2BAAO,CAAC5E,OAAO,CAAC6E,KAAT,EAAgB;AAC1CC,MAAAA,OAAO,EAAE,CAAC;AAAEC,QAAAA;AAAF,OAAD,KAAiBP,WAAW,CAACO,OAAD,CAAX,IAAwBV,WADR;AAE1CW,MAAAA,KAAK,EAAE,CAAC;AAAEC,QAAAA;AAAF,OAAD,KAAeT,WAAW,CAACS,KAAD,CAFS;AAG1CC,MAAAA,QAAQ,EAAE,CAAC;AAAE1C,QAAAA;AAAF,OAAD,KAAkBgC,WAAW,CAAChC,QAAD,CAHG;AAI1C2C,MAAAA,MAAM,EAAE,CAAC;AAAE7C,QAAAA,MAAM,EAAE8C;AAAV,OAAD,KAAuBZ,WAAW,CAACY,KAAD;AAJA,KAAhB,CAA5B;AAOA,UAAMC,OAAO,GAAG,EAAhB;AACA,QAAIC,MAAM,GAAG,GAAb,CAxByC;;AA2BzC,UAAMC,KAAK,GAAGC,eAAW,CACvB5C,YADuB,EAEvB6C,oBAAgB,CAAC,EAAD,CAFO,EAGvBC,WAAO,CAAC;AACNC,MAAAA,cAAc,EAAE,CAAC7B,GAAD;AADV,KAAD,CAHgB,CAAzB,CA3ByC;;AAoCzC,UAAM8B,yBAAyB,GAAGC,eAAW,CAACC,4BAAZ,CAChC9F,OAAO,CAAChB,QADwB,CAAlC,CApCyC;;AAyCzCf,IAAAA,OAAO,CAACC,GAAR,CACG,eAAc8B,OAAO,CAACR,IAAK,cAAaQ,OAAO,CAAChB,QAAS,mBAAkB4G,yBAA0B,EADxG;AAIAL,IAAAA,KAAK,CAACQ,QAAN,CACEC,wBAAgB,CAAChG,OAAO,CAAC6E,KAAR,CAAcoB,aAAd,IAA+BL,yBAAhC,CADlB;AAGAL,IAAAA,KAAK,CAACQ,QAAN,CAAeG,kBAAU,CAAC1C,WAAW,CAAC2C,SAAb,EAAwB3C,WAAW,CAAC4C,OAApC,CAAzB;AAEA,UAAMnF,OAAO,GAAGoF,eAAW,CAACrG,OAAO,CAAChB,QAAT,EAAmBgB,OAAO,CAAC6E,KAA3B,CAA3B;AAEA,UAAMvE,MAAM,GAAGc,aAAa,IAAIA,aAAa,CAACH,OAAD,CAA7C;AACAsE,IAAAA,KAAK,CAACQ,QAAN,CAAeO,yBAAiB,CAACrF,OAAD,EAAUX,MAAV,CAAhC;AAEA,UAAMiG,OAAO,GAAG,EAAhB;AAEA,UAAMC,GAAG,GACPC,wCAACC,4BAAD,CAAU,OAAV;AAAkB,MAAA,MAAM,EAAEC,UAAU,IAAIJ,OAAO,CAACK,IAAR,CAAaD,UAAb;AAAxC,OACEF,wCAACI,mBAAD;AAAe,MAAA,KAAK,EAAEtB;AAAtB,OACEkB,wCAACK,2BAAD;AAAc,MAAA,OAAO,EAAEzB,OAAvB;AAAgC,MAAA,QAAQ,EAAEvB;AAA1C,OACE2C,wCAAC,QAAD;AAAU,MAAA,MAAM,EAAE9D,MAAlB;AAA0B,MAAA,UAAU,EAAEG;AAAtC,MADF,CADF,CADF,CADF;;AAUA,UAAMiE,eAAe,GAAGC,OAAO,IAAI;AACjC;AACA,YAAMC,UAAU,GAAGD,OAAO,CACvBE,GADgB,CACZnF,MAAM,IAAI;AACb,YAAIA,MAAM,CAACoF,UAAP,CAAkBC,QAAlB,CAA2B,UAA3B,CAAJ,EACE,OAAOnE,mBAAmB,GACrB,8BAA6BlB,MAAM,CAACoF,UAAW,aAD1B,GAEtB,IAFJ;AAGF,eAAQ,yBAAwBpF,MAAM,CAACoF,UAAW,aAAlD;AACD,OAPgB,EAQhBE,MARgB,CAQTC,CAAC,IAAIA,CARI,CAAnB,CAFiC;;AAajCtE,MAAAA,qBAAqB,IACnBiE,UAAU,CAACL,IAAX,CACG,iBAAgB7D,gBAAiB,IAAGC,qBAAsB,aAD7D,CADF;AAKA,aAAOiE,UAAP;AACD,KAnBD;;AAqBA,UAAMpF,SAAS,GACbuB,UAAU,CAACC,OAAX,CAAmBxB,SAAnB,IAAgCuB,UAAU,CAACE,MAAX,CAAkBzB,SADpD;AAGA,UAAMD,KAAK,GACTwB,UAAU,CAACG,MAAX,CAAkB3B,KAAlB,IAA2BwB,UAAU,CAACE,MAAX,CAAkB1B,KAA7C,GACI2F,WAAW,CACTC,MAAM,CAACC,OAAP,CAAerE,UAAU,CAACG,MAAX,CAAkB3B,KAAjC,EAAwCsF,GAAxC,CAA4C,CAAC,CAACQ,GAAD,EAAMC,KAAN,CAAD,KAAkB,CAC5DD,GAD4D,EAE5DtE,UAAU,CAACE,MAAX,CAAkB1B,KAAlB,CAAwB8F,GAAxB,IACI,CAAC,GAAGC,KAAJ,EAAW,GAAGvE,UAAU,CAACE,MAAX,CAAkB1B,KAAlB,CAAwB8F,GAAxB,CAAd,CADJ,GAEIC,KAJwD,CAA9D,CADS,CADf,GASIvE,UAAU,CAACC,OAAX,CAAmBzB,KAVzB;AAYA,UAAM;AACJO,MAAAA,YADI;AAEJI,MAAAA,oBAFI;AAGJF,MAAAA;AAHI,QAIFR,SAJJ,CAvGyC;;AA8GzC,QAAI8C,YAAY,CAACG,OAAjB,EAA0B;AACxB;AACA8C,MAAAA,qBAAc,CAACpB,GAAD,CAAd,CAFwB;AAKxB;;AACA,YAAMqB,eAAe,GAAGC,kBAAU,CAAClG,KAAD,EAAQ2E,OAAR,CAAlC;AACA,YAAMU,UAAU,GAAGF,eAAe,CAACc,eAAD,CAAf,CAAiCrG,IAAjC,CAAsC,EAAtC,CAAnB;AAEA,YAAMuG,aAAa,GAAI,2CAAvB;AAEA,YAAMC,mBAAmB,GAAG7F,YAAY,CACrCF,OADyB,CACjB,WADiB,EACJ,EADI,EAEzBA,OAFyB,CAEjB,2BAFiB,EAEY,EAFZ,EAGzBA,OAHyB,CAGjB,kBAHiB,EAGG,EAHH,EAIzBA,OAJyB,CAIjB,SAJiB,EAIN,EAJM,EAKzBA,OALyB,CAKjB,qBALiB,EAKMgF,UALN,EAMzBhF,OANyB,CAMjB,gBANiB,EAMC8F,aAND,CAA5B;AAOA9H,MAAAA,QAAQ,CAACY,SAAT,CAAmB,mBAAnB,EAAwC,cAAxC;AACAZ,MAAAA,QAAQ,CAACqF,MAAT,CAAgBA,MAAhB,EAnBwB;;AAoBxB7B,MAAAA,eAAe,CAACzD,OAAD,EAAUC,QAAV,EAAoB+H,mBAApB,CAAf;AACD,KAnIwC;;;AAsIzC,QAAI,CAACrD,YAAY,CAACG,OAAlB,EAA2B;AACzBS,MAAAA,KAAK,CACF0C,OADH,CACWC,YAAQ,CAACrF,SAAD,CADnB,EAEGsF,SAFH,GAGGC,IAHH,CAGQ,MAAM;AACV,cAAMC,KAAK,GAAG,IAAIC,iCAAJ,EAAd;AAEA,cAAMlG,IAAI,GAAGwF,qBAAc,CAACS,KAAK,CAACE,aAAN,CAAoB/B,GAApB,CAAD,CAA3B;AAEA,cAAMgC,MAAM,GAAGC,0BAAM,CAACC,YAAP,EAAf;AACAD,QAAAA,0BAAM,CAACE,MAAP;AACA,cAAMC,cAAc,GAAGJ,MAAM,CAACI,cAAP,CAAsBC,QAAtB,EAAvB;AACA,YAAIC,KAAK,GAAGN,MAAM,CAACM,KAAP,CAAaD,QAAb,EAAZ;AACA,cAAME,QAAQ,GAAGP,MAAM,CAACQ,IAAP,CAAYH,QAAZ,EAAjB;;AAEA,YAAIxD,OAAO,CAACC,MAAR,KAAmB,GAAvB,EAA4B;AAC1BA,UAAAA,MAAM,GAAG,GAAT;AACAwD,UAAAA,KAAK,GAAG,mCAAR;AACD;;AAED,YAAIzD,OAAO,CAACvB,GAAZ,EAAiB;AACf,iBAAO7D,QAAQ,CAACgJ,QAAT,CAAkB,GAAlB,EAAuB5D,OAAO,CAACvB,GAA/B,CAAP;AACD;;AAED,cAAMoF,UAAU,GAAG3D,KAAK,CAAC4D,QAAN,EAAnB;AAEA,cAAMC,SAAS,GAAGf,KAAK,CAACgB,YAAN,EAAlB,CAtBU;AAyBV;;AACA,cAAMxB,eAAe,GAAGC,kBAAU,CAAClG,KAAD,EAAQ2E,OAAR,CAAlC;AACA,cAAMU,UAAU,GAAGF,eAAe,CAACc,eAAD,CAAf,CAAiCrG,IAAjC,CAAsC,EAAtC,CAAnB;AAEA,YAAI8H,mBAAmB,GAAG,EAA1B;;AACA,YAAIjE,OAAO,CAACC,MAAR,KAAmB,GAAvB,EAA4B;AAC1B;AACA,cAAIX,YAAY,CAACK,KAAjB,EAAwB;AACtBsE,YAAAA,mBAAmB,GAAGC,6BAAS,CAACL,UAAD,EAAa;AAC1CM,cAAAA,cAAc,EAAE;AAD0B,aAAb,CAA/B;AAGArJ,YAAAA,kBAAkB,CAAC+I,UAAD,EAAajJ,QAAb,EAAuBI,WAAvB,EAAoC;AACpDe,cAAAA,aADoD;AAEpDD,cAAAA;AAFoD,aAApC,CAAlB;AAIAlB,YAAAA,QAAQ,CAACqF,MAAT,CAAgBA,MAAhB,EARsB;;AAStB7B,YAAAA,eAAe,CAACzD,OAAD,EAAUC,QAAV,EAAoBqJ,mBAApB,EAAyC,MAAzC,CAAf;AACA,mBAAO,IAAP;AACD;;AACD,cAAI,CAACpG,eAAL,EAAsB;AACpBoG,YAAAA,mBAAmB,GAAGC,6BAAS,CAACL,UAAD,EAAa;AAC1CM,cAAAA,cAAc,EAAE;AAD0B,aAAb,CAA/B;AAGAF,YAAAA,mBAAmB,GAAI,+BAA8BA,mBAAoB,WAAzE;AACD;AACF;;AACD,YAAIjE,OAAO,CAACC,MAAR,KAAmB,GAAvB,EAA4B;AAC1BX,UAAAA,YAAY,CAACQ,MAAb,GAAsB,IAAtB;AACD,SArDS;;;AAwDV,YAAIsE,YAAY,GAAG,EAAnB,CAxDU;;AA2DV,YAAI9E,YAAY,CAACO,QAAb,IAAyBP,YAAY,CAACQ,MAA1C,EAAkD;AAChDhF,UAAAA,kBAAkB,CAAC+I,UAAD,EAAajJ,QAAb,EAAuBI,WAAvB,EAAoC;AACpDe,YAAAA,aADoD;AAEpDD,YAAAA;AAFoD,WAApC,CAAlB;AAIAsI,UAAAA,YAAY,GAAGC,mCAAe,CAACN,SAAD,CAAf,GAA6BhH,IAA5C;AACD,SAjES;;;AAoEV,YAAIuC,YAAY,CAACO,QAAb,IAAyB,CAACP,YAAY,CAACQ,MAA3C,EAAmD;AACjDsE,UAAAA,YAAY,GAAGlH,oBAAoB,CAChCN,OADY,CACJ,WADI,EACS6G,KADT,EAEZ7G,OAFY,CAEJ,2BAFI,EAEyB8G,QAFzB,EAGZ9G,OAHY,CAGJ,kBAHI,EAGgByH,mCAAe,CAACN,SAAD,CAH/B,EAIZnH,OAJY,CAIJ,SAJI,EAIOG,IAJP,EAKZH,OALY,CAKJ,qBALI,EAKmBgF,UALnB,EAMZhF,OANY,CAMJ,gBANI,EAMcqH,mBANd,CAAf;AAOD,SA5ES;;;AA+EV,YAAI,CAAC3E,YAAY,CAACO,QAAd,IAA0BP,YAAY,CAACQ,MAA3C,EAAmD;AACjDsE,UAAAA,YAAY,GAAGpH,kBAAkB,CAC9BJ,OADY,CACJ,WADI,EACS6G,KADT,EAEZ7G,OAFY,CAEJ,2BAFI,EAEyB8G,QAFzB,EAGZ9G,OAHY,CAGJ,kBAHI,EAGgByH,mCAAe,CAACN,SAAD,CAH/B,EAIZnH,OAJY,CAIJ,SAJI,EAIOG,IAJP,EAKZH,OALY,CAKJ,qBALI,EAKmB,EALnB,CAAf;AAMD,SAtFS;;;AAyFV,YAAI,CAAC0C,YAAY,CAACO,QAAd,IAA0B,CAACP,YAAY,CAACQ,MAA5C,EAAoD;AAClDsE,UAAAA,YAAY,GAAGtH,YAAY,CACxBF,OADY,CACJ,WADI,EACS6G,KADT,EAEZ7G,OAFY,CAEJ,2BAFI,EAEyB8G,QAFzB,EAGZ9G,OAHY,CAGJ,kBAHI,EAGgBmH,SAHhB,EAIZnH,OAJY,CAIJ,SAJI,EAIOG,IAJP,EAKZH,OALY,CAKJ,qBALI,EAKmBgF,UALnB,EAMZhF,OANY,CAMJ,gBANI,EAMcqH,mBANd,CAAf;AAOD;;AACDnJ,QAAAA,kBAAkB,CAAC+I,UAAD,EAAajJ,QAAb,EAAuBI,WAAvB,EAAoC;AACpDe,UAAAA,aADoD;AAEpDD,UAAAA;AAFoD,SAApC,CAAlB;;AAIA,YAAI;AACF;AACA,cAAIyH,cAAJ,EAAoB;AAClBa,YAAAA,YAAY,GAAGA,YAAY,CAACxH,OAAb,CACb,YADa,EAEZ,SAAQ2G,cAAe,GAFX,CAAf;AAID;;AACD3I,UAAAA,QAAQ,CAACqF,MAAT,CAAgBA,MAAhB,EARE;;AASF7B,UAAAA,eAAe,CAACzD,OAAD,EAAUC,QAAV,EAAoBwJ,YAApB,CAAf;AACD,SAVD,CAUE,OAAOE,GAAP,EAAY;AACZ;AACA1L,UAAAA,OAAO,CAACC,GAAR,CAAYyL,GAAG,CAAC7I,OAAhB;AACD;AACF,OAvHH,EAwHG8I,KAxHH,CAwHSD,GAAG,IAAI;AACZ;AACA;AACA;AACA1L,QAAAA,OAAO,CAACC,GAAR,CAAYyL,GAAZ;AACA1J,QAAAA,QAAQ,CAACqF,MAAT,CAAgB,GAAhB;AACA7B,QAAAA,eAAe,CACbzD,OADa,EAEbC,QAFa,EAGZ,yBAAwB0J,GAAG,CAACE,KAAM,UAAS1L,IAAI,CAACC,SAAL,CAAeuL,GAAf,CAAoB,EAHnD,CAAf,CANY;AAYZ;AACA;AACD,OAtIH;AAuIA/B,MAAAA,qBAAc,CAACpB,GAAD,CAAd;AAEAjB,MAAAA,KAAK,CAACuE,KAAN;AACD;AACF,GAlRD;AAmRD,CAlTD;;AC3GA,MAAMpL,GAAG,GAAGqL,2BAAO,EAAnB;;AAEA,MAAMC,KAAK,GAAG,CAACtH,QAAD,EAAW1E,MAAX,EAAmBiM,cAAnB,KAAsC;AAClD,QAAM;AAAElH,IAAAA,gBAAgB,GAAG;AAArB,MAAkC/E,MAAxC;AAEAU,EAAAA,GAAG,CAACwL,OAAJ,CAAY,cAAZ,EAHkD;;AAMlDnM,EAAAA,2BAA2B,CAACC,MAAD,CAA3B,CANkD;;AASlDiM,EAAAA,cAAc,CAACvL,GAAD,CAAd;AACAyL,EAAAA,cAAuB,CAACzL,GAAD,EAAMV,MAAM,CAACK,iBAAb,CAAvB;AACA+L,EAAAA,MAAe,CAAC1L,GAAD,EAAMgE,QAAN,EAAgB1E,MAAhB,CAAf;AAEAU,EAAAA,GAAG,CAAC2L,GAAJ,CACG,IAAGtH,gBAAiB,EADvB,EAEEgH,2BAAO,CAACzH,MAAR,CAAgB,QAAOS,gBAAiB,EAAxC,EAA2C;AAAEuH,IAAAA,MAAM,EAAE;AAAV,GAA3C,CAFF;AAKA5L,EAAAA,GAAG,CAACY,EAAJ,CAAO,OAAP,EAAgB,YAAY;AAC1B;AACA;AAEAoH,IAAAA,4BAAQ,CAAC6D,UAAT,GAAsBnC,IAAtB,CAA2B,MAAM;AAC/B,UAAIoC,MAAM,GAAG9L,GAAG,CAAC+L,MAAJ,CAAW,IAAX,EAAiB,MAAM;AAClCxM,QAAAA,OAAO,CAACyM,IAAR,CAAc,sCAAd;AACAC,QAAAA,UAAU,CAAC,YAAW;AACpBjM,UAAAA,GAAG,CAACkM,IAAJ,CAAS,aAAT;AACD,SAFS,EAEP,GAFO,CAAV;AAGD,OALY,CAAb;AAMAlM,MAAAA,GAAG,CAACY,EAAJ,CAAO,MAAP,EAAe,MAAM;AACnBkL,QAAAA,MAAM,CAACV,KAAP,CAAa,YAAW;AACtB7L,UAAAA,OAAO,CAACyM,IAAR,CAAa,YAAb;AACD,SAFD;AAGD,OAJD;AAKD,KAZD;AAaD,GAjBD;AAkBD,CApCD;;AAsCA,qBAAe;AAAEhM,EAAAA,GAAF;AAAOJ,EAAAA,QAAP;AAAiB0L,EAAAA;AAAjB,CAAf;;;;;"}