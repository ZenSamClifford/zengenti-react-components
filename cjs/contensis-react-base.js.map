{
  "version": 3,
  "file": "contensis-react-base.js",
  "sources": [
    "../src/server/util/displayStartupConfiguration.ts",
    "../src/server/features/reverse-proxy/index.ts",
    "../src/server/features/caching/cacheDuration.schema.ts",
    "../src/server/util/staticPaths.ts",
    "../src/server/middleware/bundleManipulation.ts",
    "../src/server/middleware/resolveStartup.ts",
    "../src/server/features/static-assets/index.ts",
    "../src/server/util/stringifyAttributes.ts",
    "../src/server/features/response-handler/index.ts",
    "../src/server/util/bundles.ts",
    "../src/server/util/headers.ts",
    "../src/server/webApp.tsx",
    "../src/server/internalServer.ts"
  ],
  "sourcesContent": [
    "const servers = SERVERS; /* global SERVERS */\r\nconst projects = PROJECTS; /* global PROJECTS */\r\n\r\nconst DisplayStartupConfiguration = config => {\r\n  /* eslint-disable no-console */\r\n  console.log();\r\n  console.log(\r\n    `Configured servers:\r\n`,\r\n    JSON.stringify(servers, null, 2)\r\n  );\r\n  console.log();\r\n  console.log(\r\n    `Configured projects:\r\n`,\r\n    JSON.stringify(projects, null, 2)\r\n  );\r\n  console.log();\r\n  console.log(\r\n    'Reverse proxy paths: ',\r\n    JSON.stringify(config.reverseProxyPaths, null, 2)\r\n  );\r\n  console.log();\r\n\r\n  /* eslint-enable no-console */\r\n};\r\n\r\nexport default DisplayStartupConfiguration;\r\n",
    "import { Express } from 'express';\r\nimport httpProxy from 'http-proxy';\r\n\r\nconst servers = SERVERS; /* global SERVERS */\r\nexport const apiProxy = httpProxy.createProxyServer();\r\n\r\nconst reverseProxies = (app: Express, reverseProxyPaths: string[] = []) => {\r\n  deliveryApiProxy(apiProxy, app);\r\n\r\n  app.all(reverseProxyPaths, (req, res) => {\r\n    const target =\r\n      req.hostname.indexOf('preview-') ||\r\n      req.hostname.indexOf('preview.') ||\r\n      req.hostname === 'localhost'\r\n        ? servers.previewIis || servers.iis\r\n        : servers.iis;\r\n\r\n    apiProxy.web(req, res, { target, changeOrigin: true });\r\n    apiProxy.on('error', e => {\r\n      /* eslint-disable no-console */\r\n      console.log(\r\n        `Proxy Request for ${req.path} HostName:${req.hostname} failed with ${e}`\r\n      );\r\n      /* eslint-enable no-console */\r\n    });\r\n  });\r\n};\r\n\r\nconst deliveryApiProxy = (apiProxy, app) => {\r\n  // This is just here to stop cors requests on localhost. In Production this is mapped using varnish.\r\n  app.all(['/api/delivery/*', '/api/image/*'], (req, res) => {\r\n    /* eslint-disable no-console */\r\n    const target = servers.cms;\r\n    console.log(`Proxying api request to ${servers.alias}`);\r\n    apiProxy.web(req, res, {\r\n      target,\r\n      changeOrigin: true,\r\n    });\r\n    apiProxy.on('error', e => {\r\n      /* eslint-disable no-console */\r\n      console.log(\r\n        `Proxy request for ${req.path} HostName:${req.hostname} failed with ${e}`\r\n      );\r\n      /* eslint-enable no-console */\r\n    });\r\n  });\r\n};\r\n\r\nexport default reverseProxies;\r\n",
    "export const CacheDuration = {\r\n  200: '3600',\r\n  404: '5',\r\n  static: '31536000', // Believe it or not these two max ages are the same in runtime\r\n  expressStatic: '31557600h', // Believe it or not these two max ages are the same in runtime\r\n};\r\n\r\nexport const getCacheDuration = (status = 200) => {\r\n  if (status > 400) return CacheDuration[404];\r\n  return CacheDuration[200];\r\n};\r\n",
    "export const replaceStaticPath = (str: string, staticFolderPath = 'static') =>\r\n  str.replace(/static\\//g, `${staticFolderPath}/`);\r\n",
    "import { RequestHandler } from 'express';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport { replaceStaticPath } from '../util/staticPaths';\r\n\r\nexport const bundleManipulationMiddleware =\r\n  ({\r\n    appRootPath,\r\n    maxage,\r\n    staticRoutePath,\r\n  }: {\r\n    appRootPath: string;\r\n    maxage: string;\r\n    staticRoutePath: string;\r\n  }): RequestHandler =>\r\n  (req, res, next) => {\r\n    const filename = path.basename(req.path);\r\n    const modernBundle = filename.endsWith('.mjs');\r\n    const legacyBundle = filename.endsWith('.js');\r\n    if ((legacyBundle || modernBundle) && filename.startsWith('runtime.')) {\r\n      const jsRuntimeLocation = path.resolve(\r\n        appRootPath,\r\n        `dist/static/${modernBundle ? 'modern/js' : 'legacy/js'}/${filename}`\r\n      );\r\n      try {\r\n        const jsRuntimeBundle = fs.readFileSync(jsRuntimeLocation, 'utf8');\r\n        const modifiedBundle = replaceStaticPath(\r\n          jsRuntimeBundle,\r\n          staticRoutePath\r\n        );\r\n        if (maxage) res.set('Cache-Control', `public, max-age=${maxage}`);\r\n        res.type('.js').send(modifiedBundle);\r\n        return;\r\n      } catch (readError) {\r\n        // eslint-disable-next-line no-console\r\n        console.log(\r\n          `Unable to find js runtime bundle at '${jsRuntimeLocation}'`,\r\n          readError\r\n        );\r\n        next();\r\n      }\r\n    } else {\r\n      next();\r\n    }\r\n  };\r\n",
    "import { RequestHandler } from 'express';\r\nimport path from 'path';\r\n\r\n/**\r\n *\r\n * @param { appRootPath: string; maxage: number; staticFolderPath: string, startupScriptFilename: string } args\r\n * @returns Response | next()\r\n * A middleware function to resolve /dist/static/startup.js under a supplied startupScriptFilename variable\r\n */\r\nexport const resolveStartupMiddleware =\r\n  ({\r\n    appRootPath,\r\n    maxage,\r\n    staticFolderPath,\r\n    startupScriptFilename,\r\n  }: {\r\n    appRootPath: string;\r\n    maxage: string;\r\n    staticFolderPath: string;\r\n    startupScriptFilename: string;\r\n  }): RequestHandler =>\r\n  (req, res, next) => {\r\n    if (\r\n      startupScriptFilename !== 'startup.js' &&\r\n      req.path === `/${startupScriptFilename}`\r\n    ) {\r\n      const startupFilePath = `dist/${staticFolderPath}/startup.js`;\r\n      const startupFileLocation = path.resolve(appRootPath, startupFilePath);\r\n\r\n      if (maxage) res.set('Cache-Control', `public, max-age=${maxage}`);\r\n\r\n      try {\r\n        res.sendFile(startupFileLocation);\r\n      } catch (sendFileError) {\r\n        // eslint-disable-next-line no-console\r\n        console.log(\r\n          `Unable to send file startup.js at '${startupFileLocation}'`,\r\n          sendFileError\r\n        );\r\n        next();\r\n      }\r\n    } else {\r\n      next();\r\n    }\r\n  };\r\n",
    "import express from 'express';\r\nimport { CacheDuration } from '~/server/features/caching/cacheDuration.schema';\r\nimport { bundleManipulationMiddleware } from '~/server/middleware/bundleManipulation';\r\nimport { resolveStartupMiddleware } from '~/server/middleware/resolveStartup';\r\n\r\nimport { path as appPath } from 'app-root-path';\r\nimport { ServerConfig } from '~/config';\r\n// Serving static assets\r\nconst staticAssets = (\r\n  app,\r\n  {\r\n    appRootPath = appPath,\r\n    scripts = {} as NonNullable<ServerConfig['scripts']>,\r\n    startupScriptFilename = 'startup.js',\r\n    staticFolderPath = 'static',\r\n    staticRoutePath = 'static',\r\n    staticRoutePaths = [] as string[],\r\n  }\r\n) => {\r\n  app.use(\r\n    [\r\n      `/${staticRoutePath}`,\r\n      ...staticRoutePaths.map(p => `/${p}`),\r\n      `/${staticFolderPath}`,\r\n    ],\r\n    bundleManipulationMiddleware({\r\n      appRootPath,\r\n      // these maxage values are different in config but the same in runtime,\r\n      // this one is the true value in seconds\r\n      maxage: CacheDuration.static,\r\n      staticRoutePath,\r\n    }),\r\n    resolveStartupMiddleware({\r\n      appRootPath,\r\n      maxage: CacheDuration.static,\r\n      startupScriptFilename: scripts.startup || startupScriptFilename,\r\n      staticFolderPath,\r\n    }),\r\n    // eslint-disable-next-line import/no-named-as-default-member\r\n    express.static(`dist/${staticFolderPath}`, {\r\n      // these maxage values are different in config but the same in runtime,\r\n      // this one is somehow converted and should end up being the same as CacheDuration.static\r\n      maxAge: CacheDuration.expressStatic,\r\n    })\r\n  );\r\n};\r\n\r\nexport default staticAssets;\r\n",
    "export default (attributes = {}) =>\r\n  Object.entries(attributes)\r\n    .map(\r\n      ([key, value], idx) =>\r\n        `${idx !== 0 ? ' ' : ''}${key}${value ? `=\"${value}\"` : ''}`\r\n    )\r\n    .join(' ');\r\n",
    "/* eslint-disable no-console */\r\nimport { Request, Response } from 'express';\r\nimport { ResponseMethod } from './types';\r\n\r\n/**\r\n * Web Application Response handler, sends a prepared express js response\r\n * with the supplied content sending in the specified manner\r\n * @param {response} request express js request object\r\n * @param {response} response express js response object\r\n * @param {string | object} content the content to send in the response body\r\n * @param {\"send\" | \"json\" | \"end\"} send the response function to call e.g res.send() res.json() res.end()\r\n */\r\nconst handleResponse = (\r\n  request: Request,\r\n  response: Response,\r\n  content: any,\r\n  send: keyof typeof ResponseMethod = 'send'\r\n) => {\r\n  // console.log('---', response.statusCode, '---');\r\n  response[send](content);\r\n};\r\n\r\nexport default handleResponse;\r\n",
    "import fs from 'fs';\r\nimport path from 'path';\r\nimport { ChunkExtractor } from '@loadable/server';\r\nimport { replaceStaticPath } from './staticPaths';\r\nimport { ServerConfig } from '~/config';\r\nimport stringifyAttributes from './stringifyAttributes';\r\n\r\nconst readFileSync = path => fs.readFileSync(path, 'utf8');\r\n\r\nexport const loadableBundleData = (\r\n  { stats, templates },\r\n  staticRoutePath: string,\r\n  build?: string\r\n) => {\r\n  const bundle: {\r\n    stats?: string | null;\r\n    templates?: {\r\n      templateHTML;\r\n      templateHTMLStatic;\r\n      templateHTMLFragment;\r\n    } | null;\r\n  } = {};\r\n  try {\r\n    bundle.stats = JSON.parse(\r\n      readFileSync(stats.replace('/target', build ? `/${build}` : ''))\r\n    );\r\n  } catch (ex) {\r\n    // console.info(ex);\r\n    bundle.stats = null;\r\n  }\r\n  try {\r\n    bundle.templates = {\r\n      templateHTML: replaceStaticPath(\r\n        readFileSync(\r\n          templates.html.replace('/target', build ? `/${build}` : '')\r\n        ),\r\n        staticRoutePath\r\n      ),\r\n      templateHTMLStatic: replaceStaticPath(\r\n        readFileSync(\r\n          templates.static.replace('/target', build ? `/${build}` : '')\r\n        ),\r\n        staticRoutePath\r\n      ),\r\n      templateHTMLFragment: replaceStaticPath(\r\n        readFileSync(\r\n          templates.fragment.replace('/target', build ? `/${build}` : '')\r\n        ),\r\n        staticRoutePath\r\n      ),\r\n    };\r\n  } catch (ex) {\r\n    // console.info(ex);\r\n    bundle.templates = null;\r\n  }\r\n  return bundle;\r\n};\r\n\r\ntype LoadableChunkExtractors =\r\n  | {\r\n      legacy: ChunkExtractor;\r\n      modern: ChunkExtractor;\r\n      commonLoadableExtractor: ChunkExtractor;\r\n    }\r\n  | undefined;\r\n\r\nexport const loadableChunkExtractors = () => {\r\n  try {\r\n    const modern = new ChunkExtractor({\r\n      entrypoints: ['app'],\r\n      namespace: 'modern',\r\n      statsFile: path.resolve('dist/modern/loadable-stats.json'),\r\n    });\r\n    const legacy = new ChunkExtractor({\r\n      entrypoints: ['app'],\r\n      namespace: 'legacy',\r\n      statsFile: path.resolve('dist/legacy/loadable-stats.json'),\r\n    });\r\n    const commonLoadableExtractor: ChunkExtractor = {\r\n      addChunk(chunk) {\r\n        modern.addChunk(chunk);\r\n        if (typeof legacy.stats.assetsByChunkName[chunk] !== 'undefined')\r\n          legacy.addChunk(chunk);\r\n      },\r\n    };\r\n\r\n    return {\r\n      commonLoadableExtractor,\r\n      modern,\r\n      legacy,\r\n    } as LoadableChunkExtractors;\r\n  } catch (e) {\r\n    console.info('@loadable/server ChunkExtractor not available');\r\n  }\r\n};\r\n\r\nexport const getBundleData = (config, staticRoutePath) => {\r\n  const bundleData = {\r\n    default: loadableBundleData(config, staticRoutePath),\r\n    legacy: loadableBundleData(config, staticRoutePath, 'legacy'),\r\n    modern: loadableBundleData(config, staticRoutePath, 'modern'),\r\n  };\r\n  if (!bundleData.default || bundleData.default === {})\r\n    bundleData.default = bundleData.legacy || bundleData.modern;\r\n  return bundleData;\r\n};\r\n\r\nexport const buildBundleTags = (\r\n  bundles,\r\n  differentialBundles = false,\r\n  staticRoutePath = 'static',\r\n  attributes = ''\r\n) => {\r\n  // Take the bundles returned from Loadable.Capture\r\n  const bundleTags = bundles\r\n    .filter(b => b)\r\n    .map(bundle => {\r\n      if (bundle.publicPath.includes('/modern/'))\r\n        return differentialBundles\r\n          ? `<script ${attributes} type=\"module\" src=\"${replaceStaticPath(\r\n              bundle.publicPath,\r\n              staticRoutePath\r\n            )}\"></script>`\r\n          : null;\r\n      return `<script ${attributes}${\r\n        differentialBundles ? ' nomodule' : ''\r\n      } src=\"${replaceStaticPath(\r\n        bundle.publicPath,\r\n        staticRoutePath\r\n      )}\"></script>`;\r\n    })\r\n    .filter(f => f);\r\n\r\n  return bundleTags;\r\n};\r\n\r\nexport const getBundleTags = (\r\n  loadableExtractor: LoadableChunkExtractors,\r\n  scripts: ServerConfig['scripts'],\r\n  staticRoutePath = 'static'\r\n) => {\r\n  let startupTag = '';\r\n  // Add the static startup script to the bundleTags\r\n  if (scripts?.startup)\r\n    startupTag = `<script ${stringifyAttributes(\r\n      scripts.attributes\r\n    )} src=\"/${staticRoutePath}/${scripts.startup}\"></script>`;\r\n\r\n  // Get the script tags from their respective extractor instances\r\n  if (loadableExtractor) {\r\n    const legacyScriptTags = loadableExtractor?.legacy.getScriptTags({\r\n      noModule: true,\r\n    });\r\n    const modernScriptTags = loadableExtractor?.modern.getScriptTags({\r\n      type: 'module',\r\n    });\r\n    return `${startupTag}${legacyScriptTags || ''}${modernScriptTags || ''}`;\r\n  }\r\n  return startupTag;\r\n};\r\n",
    "import { Response } from 'express';\r\nimport {\r\n  selectCurrentProject,\r\n  selectRouteEntry,\r\n} from '~/routing/redux/selectors';\r\nimport { getImmutableOrJS as getIn } from '~/redux/util';\r\n\r\nimport { getCacheDuration } from '../features/caching/cacheDuration.schema';\r\n\r\nexport const addStandardHeaders = (\r\n  state: any,\r\n  response: Response,\r\n  packagejson: any,\r\n  groups: { globalGroups?: any[]; allowedGroups?: any[] }\r\n) => {\r\n  if (state) {\r\n    try {\r\n      console.info('About to add headers');\r\n      const routingSurrogateKeys = getIn(\r\n        state,\r\n        ['routing', 'surrogateKeys'],\r\n        ''\r\n      );\r\n\r\n      const surrogateKeyHeader = ` ${packagejson.name}-app ${routingSurrogateKeys}`;\r\n\r\n      response.header('surrogate-key', surrogateKeyHeader);\r\n\r\n      addVarnishAuthenticationHeaders(state, response, groups);\r\n\r\n      response.setHeader(\r\n        'Surrogate-Control',\r\n        `max-age=${getCacheDuration(response.statusCode)}`\r\n      );\r\n    } catch (e: any) {\r\n      console.info('Error Adding headers', e.message);\r\n    }\r\n  }\r\n};\r\n\r\nexport const addVarnishAuthenticationHeaders = (\r\n  state: any,\r\n  response: Response,\r\n  groups: { globalGroups?: any[]; allowedGroups?: any[] } = {}\r\n) => {\r\n  if (state) {\r\n    try {\r\n      const stateEntry = selectRouteEntry(state);\r\n      const project = selectCurrentProject(state);\r\n      const { globalGroups, allowedGroups } = groups;\r\n      // console.info(globalGroups, allowedGroups);\r\n      let allGroups = Array.from((globalGroups && globalGroups[project]) || {});\r\n      if (\r\n        stateEntry &&\r\n        getIn(stateEntry, ['authentication', 'isLoginRequired']) &&\r\n        allowedGroups &&\r\n        allowedGroups[project]\r\n      ) {\r\n        allGroups = [...allGroups, ...allowedGroups[project]];\r\n      }\r\n      response.header('x-contensis-viewer-groups', allGroups.join('|'));\r\n    } catch (e) {\r\n      console.info('Error adding authentication header', e);\r\n    }\r\n  }\r\n};\r\n",
    "import fs from 'fs';\r\nimport React from 'react';\r\nimport { renderToString } from 'react-dom/server';\r\nimport { StaticRouter } from 'react-router-dom';\r\nimport { Provider as ReduxProvider } from 'react-redux';\r\nimport { matchRoutes } from 'react-router-config';\r\nimport Helmet from 'react-helmet';\r\nimport { ServerStyleSheet } from 'styled-components';\r\nimport serialize from 'serialize-javascript';\r\nimport minifyCssString from 'minify-css-string';\r\nimport mapJson from 'jsonpath-mapper';\r\nimport { Express } from 'express';\r\nimport { StaticRouterContext } from 'react-router';\r\nimport { ChunkExtractorManager } from '@loadable/server';\r\n\r\nimport createStore from '~/redux/store/store';\r\nimport { history } from '~/redux/store/history';\r\nimport rootSaga from '~/redux/sagas';\r\n\r\nimport { setVersion, setVersionStatus } from '~/redux/actions/version';\r\nimport { setCurrentProject } from '~/routing/redux/actions';\r\n\r\nimport { deliveryApi } from '~/util/ContensisDeliveryApi';\r\nimport pickProject from '~/util/pickProject';\r\nimport stringifyAttributes from './util/stringifyAttributes';\r\n\r\nimport { getCacheDuration } from './features/caching/cacheDuration.schema';\r\nimport handleResponse from './features/response-handler';\r\n\r\nimport {\r\n  getBundleData,\r\n  getBundleTags,\r\n  loadableChunkExtractors,\r\n} from './util/bundles';\r\nimport { addStandardHeaders } from './util/headers';\r\n\r\nimport { ServerConfig } from '~/config';\r\nimport { AppState } from '~/redux/appstate';\r\n\r\nconst webApp = (\r\n  app: Express,\r\n  ReactApp: React.ComponentType<any>,\r\n  config: ServerConfig & {\r\n    allowedGroups?: string[];\r\n    globalGroups?: string[];\r\n    startupScriptFilename?: string;\r\n  }\r\n) => {\r\n  const {\r\n    stateType = 'immutable',\r\n    routes,\r\n    withReducers,\r\n    withSagas,\r\n    withEvents,\r\n    packagejson,\r\n    scripts = {},\r\n    staticFolderPath = 'static',\r\n    startupScriptFilename,\r\n    allowedGroups,\r\n    globalGroups,\r\n    disableSsrRedux,\r\n    handleResponses,\r\n  } = config;\r\n  const staticRoutePath = config.staticRoutePath || staticFolderPath;\r\n\r\n  const bundleData = getBundleData(config, staticRoutePath);\r\n\r\n  const attributes = stringifyAttributes(scripts.attributes);\r\n  scripts.startup = scripts.startup || startupScriptFilename;\r\n\r\n  const responseHandler =\r\n    typeof handleResponses === 'function' ? handleResponses : handleResponse;\r\n\r\n  const versionInfo = JSON.parse(\r\n    fs.readFileSync(`dist/${staticFolderPath}/version.json`, 'utf8')\r\n  );\r\n\r\n  app.get('/*', async (request, response) => {\r\n    const { url } = request;\r\n\r\n    const matchedStaticRoute = () =>\r\n      matchRoutes(routes.StaticRoutes, request.path);\r\n    const isStaticRoute = () => matchedStaticRoute().length > 0;\r\n    const staticRoute = isStaticRoute() && matchedStaticRoute()[0];\r\n\r\n    // Allow certain routes to avoid SSR\r\n    const onlyDynamic = staticRoute && staticRoute.route.ssr === false;\r\n    const onlySSR = staticRoute && staticRoute.route.ssrOnly === true;\r\n\r\n    const normaliseQs = q => (q && q.toLowerCase() === 'true' ? true : false);\r\n\r\n    // Determine functional params from QueryString and set access methods\r\n    const accessMethod = mapJson<\r\n      any,\r\n      { DYNAMIC: boolean; REDUX: boolean; FRAGMENT: boolean; STATIC: boolean }\r\n    >(request.query, {\r\n      DYNAMIC: ({ dynamic }) => normaliseQs(dynamic) || onlyDynamic,\r\n      REDUX: ({ redux }) => normaliseQs(redux),\r\n      FRAGMENT: ({ fragment }) => normaliseQs(fragment),\r\n      STATIC: ({ static: value }) => normaliseQs(value) || onlySSR,\r\n    });\r\n\r\n    const context: StaticRouterContext = {};\r\n    // Track the current statusCode via the response object\r\n    response.status(200);\r\n\r\n    // Create a store (with a memory history) from our current url\r\n    const store = await createStore(\r\n      withReducers,\r\n      {} as AppState,\r\n      history({\r\n        initialEntries: [url],\r\n      }),\r\n      stateType\r\n    );\r\n\r\n    // dispatch any global and non-saga related actions before calling our JSX\r\n    const versionStatusFromHostname = deliveryApi.getVersionStatusFromHostname(\r\n      request.hostname\r\n    );\r\n\r\n    console.info(\r\n      `Request for ${request.path} hostname: ${request.hostname} versionStatus: ${versionStatusFromHostname}`\r\n    );\r\n\r\n    store.dispatch(\r\n      setVersionStatus(request.query.versionStatus || versionStatusFromHostname)\r\n    );\r\n    store.dispatch(setVersion(versionInfo.commitRef, versionInfo.buildNo));\r\n\r\n    const project = pickProject(request.hostname, request.query);\r\n\r\n    const groups = allowedGroups && allowedGroups[project];\r\n    store.dispatch(setCurrentProject(project, groups, request.hostname));\r\n\r\n    const loadableExtractor = loadableChunkExtractors();\r\n\r\n    const jsx = (\r\n      <ChunkExtractorManager\r\n        extractor={loadableExtractor?.commonLoadableExtractor}\r\n      >\r\n        <ReduxProvider store={store}>\r\n          <StaticRouter context={context} location={url}>\r\n            <ReactApp routes={routes} withEvents={withEvents} />\r\n          </StaticRouter>\r\n        </ReduxProvider>\r\n      </ChunkExtractorManager>\r\n    );\r\n\r\n    const { templateHTML, templateHTMLFragment, templateHTMLStatic } =\r\n      bundleData.default.templates || bundleData.legacy.templates || {};\r\n\r\n    // Serve a blank HTML page with client scripts to load the app in the browser\r\n    if (accessMethod.DYNAMIC) {\r\n      // Dynamic doesn't need sagas\r\n      renderToString(jsx);\r\n\r\n      // Dynamic page render has only the necessary bundles to start up the app\r\n      // and does not include any react-loadable code-split bundles\r\n      const bundleTags = getBundleTags(loadableExtractor, scripts);\r\n\r\n      const isDynamicHint = `<script ${attributes}>window.isDynamic = true;</script>`;\r\n\r\n      const responseHtmlDynamic = templateHTML\r\n        .replace('{{TITLE}}', '')\r\n        .replace('{{SEO_CRITICAL_METADATA}}', '')\r\n        .replace('{{CRITICAL_CSS}}', '')\r\n        .replace('{{APP}}', '')\r\n        .replace('{{LOADABLE_CHUNKS}}', bundleTags)\r\n        .replace('{{REDUX_DATA}}', isDynamicHint);\r\n      // Dynamic pages always return a 200 so we can run\r\n      // the app and serve up all errors inside the client\r\n      response.setHeader(\r\n        'Surrogate-Control',\r\n        `max-age=${getCacheDuration(200)}`\r\n      );\r\n      responseHandler(request, response, responseHtmlDynamic);\r\n    }\r\n\r\n    // Render the JSX server side and send response as per access method options\r\n    if (!accessMethod.DYNAMIC) {\r\n      store\r\n        .runSaga(rootSaga(withSagas))\r\n        .toPromise()\r\n        .then(() => {\r\n          const sheet = new ServerStyleSheet();\r\n\r\n          const html = renderToString(sheet.collectStyles(jsx));\r\n\r\n          const helmet = Helmet.renderStatic();\r\n          Helmet.rewind();\r\n          const htmlAttributes = helmet.htmlAttributes.toString();\r\n          let title = helmet.title.toString();\r\n          const metadata = helmet.meta.toString();\r\n\r\n          if (context.url) {\r\n            return response.redirect(302, context.url);\r\n          }\r\n\r\n          const reduxState = store.getState();\r\n\r\n          const styleTags = sheet.getStyleTags();\r\n\r\n          // After running rootSaga there should be an additional react-loadable\r\n          // code-split bundles for any page components as well as core app bundles\r\n          const bundleTags = getBundleTags(loadableExtractor, scripts);\r\n\r\n          let serialisedReduxData = '';\r\n          if (context.statusCode !== 404) {\r\n            // For a request that returns a redux state object as a response\r\n            if (accessMethod.REDUX) {\r\n              serialisedReduxData = serialize(reduxState, {\r\n                ignoreFunction: true,\r\n              });\r\n              addStandardHeaders(reduxState, response, packagejson, {\r\n                allowedGroups,\r\n                globalGroups,\r\n              });\r\n              responseHandler(request, response, serialisedReduxData, 'json');\r\n              return true;\r\n            }\r\n            if (!disableSsrRedux) {\r\n              serialisedReduxData = serialize(reduxState, {\r\n                ignoreFunction: true,\r\n              });\r\n              serialisedReduxData = `<script ${attributes}>window.REDUX_DATA = ${serialisedReduxData}</script>`;\r\n            }\r\n          }\r\n          if ((context.statusCode || 200) > 400) {\r\n            accessMethod.STATIC = true;\r\n          }\r\n\r\n          // Responses\r\n          let responseHTML = '';\r\n\r\n          if (context.statusCode === 404)\r\n            title = '<title>404 page not found</title>';\r\n\r\n          // Static page served as a fragment\r\n          if (accessMethod.FRAGMENT && accessMethod.STATIC) {\r\n            responseHTML = minifyCssString(styleTags) + html;\r\n          }\r\n\r\n          // Page fragment served with client scripts and redux data that hydrate the app client side\r\n          if (accessMethod.FRAGMENT && !accessMethod.STATIC) {\r\n            responseHTML = templateHTMLFragment\r\n              .replace('{{TITLE}}', title)\r\n              .replace('{{SEO_CRITICAL_METADATA}}', metadata)\r\n              .replace('{{CRITICAL_CSS}}', minifyCssString(styleTags))\r\n              .replace('{{APP}}', html)\r\n              .replace('{{LOADABLE_CHUNKS}}', bundleTags)\r\n              .replace('{{REDUX_DATA}}', serialisedReduxData);\r\n          }\r\n\r\n          // Full HTML page served statically\r\n          if (!accessMethod.FRAGMENT && accessMethod.STATIC) {\r\n            responseHTML = templateHTMLStatic\r\n              .replace('{{TITLE}}', title)\r\n              .replace('{{SEO_CRITICAL_METADATA}}', metadata)\r\n              .replace('{{CRITICAL_CSS}}', minifyCssString(styleTags))\r\n              .replace('{{APP}}', html)\r\n              .replace('{{LOADABLE_CHUNKS}}', '');\r\n          }\r\n\r\n          // Full HTML page served with client scripts and redux data that hydrate the app client side\r\n          if (!accessMethod.FRAGMENT && !accessMethod.STATIC) {\r\n            responseHTML = templateHTML\r\n              .replace('{{TITLE}}', title)\r\n              .replace('{{SEO_CRITICAL_METADATA}}', metadata)\r\n              .replace('{{CRITICAL_CSS}}', styleTags)\r\n              .replace('{{APP}}', html)\r\n              .replace('{{LOADABLE_CHUNKS}}', bundleTags)\r\n              .replace('{{REDUX_DATA}}', serialisedReduxData);\r\n          }\r\n\r\n          // Set response.status from React StaticRouter\r\n          if (typeof context.statusCode === 'number')\r\n            response.status(context.statusCode);\r\n\r\n          addStandardHeaders(reduxState, response, packagejson, {\r\n            allowedGroups,\r\n            globalGroups,\r\n          });\r\n          try {\r\n            // If react-helmet htmlAttributes are being used,\r\n            // replace the html tag with those attributes sepcified\r\n            // e.g. (lang, dir etc.)\r\n            if (htmlAttributes) {\r\n              responseHTML = responseHTML.replace(\r\n                /<html?.+?>/,\r\n                `<html ${htmlAttributes}>`\r\n              );\r\n            }\r\n            responseHandler(request, response, responseHTML);\r\n          } catch (err: any) {\r\n            console.info(err.message);\r\n          }\r\n        })\r\n        .catch(err => {\r\n          // Handle any error that occurred in any of the previous\r\n          // promises in the chain.\r\n          console.info(err);\r\n          response.status(500);\r\n          responseHandler(\r\n            request,\r\n            response,\r\n            `Error occurred: <br />${err.stack} <br />${JSON.stringify(err)}`\r\n          );\r\n        });\r\n      renderToString(jsx);\r\n\r\n      store.close();\r\n    }\r\n  });\r\n};\r\n\r\nexport default webApp;\r\n",
    "import 'isomorphic-fetch';\r\nimport express, { Express } from 'express';\r\nimport Loadable from 'react-loadable';\r\nimport React from 'react';\r\n\r\nimport DisplayStartupConfiguration from './util/displayStartupConfiguration';\r\nimport ConfigureReverseProxies, { apiProxy } from './features/reverse-proxy';\r\nimport ServeStaticAssets from './features/static-assets';\r\nimport ConfigureWebApp from './webApp';\r\nimport { ServerConfig } from '~/config';\r\n\r\ndeclare let global: typeof globalThis & {\r\n  DISABLE_SSR_REDUX: boolean | undefined;\r\n  PACKAGE_JSON: any;\r\n  PROXY_DELIVERY_API: boolean | undefined;\r\n  REVERSE_PROXY_PATHS: string[];\r\n};\r\n\r\nconst app: Express = express();\r\n\r\nconst start = (\r\n  ReactApp: React.ComponentType<any>,\r\n  config: ServerConfig,\r\n  ServerFeatures: (app: Express) => void\r\n) => {\r\n  global.PACKAGE_JSON = config.packagejson;\r\n  global.DISABLE_SSR_REDUX = config.disableSsrRedux;\r\n  global.PROXY_DELIVERY_API = config.proxyDeliveryApi;\r\n  global.REVERSE_PROXY_PATHS = Object(config.reverseProxyPaths);\r\n\r\n  app.disable('x-powered-by');\r\n\r\n  // Output some information about the used build/startup configuration\r\n  DisplayStartupConfiguration(config);\r\n\r\n  ServerFeatures(app);\r\n  // Set-up local proxy for images from cms, and delivery api requests\r\n  // to save doing rewrites and extra code\r\n  ConfigureReverseProxies(app, config.reverseProxyPaths);\r\n  ServeStaticAssets(app, config);\r\n  ConfigureWebApp(app, ReactApp, config);\r\n\r\n  app.on('ready', async () => {\r\n    // Configure DNS to make life easier\r\n    // await ConfigureLocalDNS();\r\n\r\n    Loadable.preloadAll().then(() => {\r\n      const server = app.listen(3001, () => {\r\n        console.info(`HTTP server is listening @ port 3001`);\r\n        setTimeout(function () {\r\n          app.emit('app_started');\r\n        }, 500);\r\n      });\r\n      app.on('stop', () => {\r\n        server.close(function () {\r\n          console.info('GoodBye :(');\r\n        });\r\n      });\r\n    });\r\n  });\r\n};\r\n\r\nexport default { app, apiProxy, start };\r\n"
  ],
  "names": [
    "servers",
    "SERVERS",
    "projects",
    "PROJECTS",
    "DisplayStartupConfiguration",
    "config",
    "console",
    "log",
    "JSON",
    "stringify",
    "reverseProxyPaths",
    "apiProxy",
    "httpProxy",
    "createProxyServer",
    "reverseProxies",
    "app",
    "deliveryApiProxy",
    "all",
    "req",
    "res",
    "target",
    "hostname",
    "indexOf",
    "previewIis",
    "iis",
    "web",
    "changeOrigin",
    "on",
    "e",
    "path",
    "cms",
    "alias",
    "CacheDuration",
    "static",
    "expressStatic",
    "getCacheDuration",
    "status",
    "replaceStaticPath",
    "str",
    "staticFolderPath",
    "replace",
    "bundleManipulationMiddleware",
    "appRootPath",
    "maxage",
    "staticRoutePath",
    "next",
    "filename",
    "basename",
    "modernBundle",
    "endsWith",
    "legacyBundle",
    "startsWith",
    "jsRuntimeLocation",
    "resolve",
    "jsRuntimeBundle",
    "fs",
    "readFileSync",
    "modifiedBundle",
    "set",
    "type",
    "send",
    "readError",
    "resolveStartupMiddleware",
    "startupScriptFilename",
    "startupFilePath",
    "startupFileLocation",
    "sendFile",
    "sendFileError",
    "staticAssets",
    "appPath",
    "scripts",
    "staticRoutePaths",
    "use",
    "map",
    "p",
    "startup",
    "express",
    "maxAge",
    "attributes",
    "Object",
    "entries",
    "key",
    "value",
    "idx",
    "join",
    "handleResponse",
    "request",
    "response",
    "content",
    "loadableBundleData",
    "stats",
    "templates",
    "build",
    "bundle",
    "parse",
    "ex",
    "templateHTML",
    "html",
    "templateHTMLStatic",
    "templateHTMLFragment",
    "fragment",
    "loadableChunkExtractors",
    "modern",
    "ChunkExtractor",
    "entrypoints",
    "namespace",
    "statsFile",
    "legacy",
    "commonLoadableExtractor",
    "addChunk",
    "chunk",
    "assetsByChunkName",
    "info",
    "getBundleData",
    "bundleData",
    "default",
    "getBundleTags",
    "loadableExtractor",
    "startupTag",
    "stringifyAttributes",
    "legacyScriptTags",
    "getScriptTags",
    "noModule",
    "modernScriptTags",
    "addStandardHeaders",
    "state",
    "packagejson",
    "groups",
    "routingSurrogateKeys",
    "getIn",
    "surrogateKeyHeader",
    "name",
    "header",
    "addVarnishAuthenticationHeaders",
    "setHeader",
    "statusCode",
    "message",
    "stateEntry",
    "selectRouteEntry",
    "project",
    "selectCurrentProject",
    "globalGroups",
    "allowedGroups",
    "allGroups",
    "Array",
    "from",
    "webApp",
    "ReactApp",
    "stateType",
    "routes",
    "withReducers",
    "withSagas",
    "withEvents",
    "disableSsrRedux",
    "handleResponses",
    "responseHandler",
    "versionInfo",
    "get",
    "url",
    "matchedStaticRoute",
    "matchRoutes",
    "StaticRoutes",
    "isStaticRoute",
    "length",
    "staticRoute",
    "onlyDynamic",
    "route",
    "ssr",
    "onlySSR",
    "ssrOnly",
    "normaliseQs",
    "q",
    "toLowerCase",
    "accessMethod",
    "mapJson",
    "query",
    "DYNAMIC",
    "dynamic",
    "REDUX",
    "redux",
    "FRAGMENT",
    "STATIC",
    "context",
    "store",
    "createStore",
    "history",
    "initialEntries",
    "versionStatusFromHostname",
    "deliveryApi",
    "getVersionStatusFromHostname",
    "dispatch",
    "setVersionStatus",
    "versionStatus",
    "setVersion",
    "commitRef",
    "buildNo",
    "pickProject",
    "setCurrentProject",
    "jsx",
    "React",
    "ChunkExtractorManager",
    "ReduxProvider",
    "StaticRouter",
    "renderToString",
    "bundleTags",
    "isDynamicHint",
    "responseHtmlDynamic",
    "runSaga",
    "rootSaga",
    "toPromise",
    "then",
    "sheet",
    "ServerStyleSheet",
    "collectStyles",
    "helmet",
    "Helmet",
    "renderStatic",
    "rewind",
    "htmlAttributes",
    "toString",
    "title",
    "metadata",
    "meta",
    "redirect",
    "reduxState",
    "getState",
    "styleTags",
    "getStyleTags",
    "serialisedReduxData",
    "serialize",
    "ignoreFunction",
    "responseHTML",
    "minifyCssString",
    "err",
    "catch",
    "stack",
    "close",
    "start",
    "ServerFeatures",
    "global",
    "PACKAGE_JSON",
    "DISABLE_SSR_REDUX",
    "PROXY_DELIVERY_API",
    "proxyDeliveryApi",
    "REVERSE_PROXY_PATHS",
    "disable",
    "ConfigureReverseProxies",
    "ServeStaticAssets",
    "ConfigureWebApp",
    "Loadable",
    "preloadAll",
    "server",
    "listen",
    "setTimeout",
    "emit"
  ],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAMA,SAAO,GAAGC,OAAhB;AAAyB;;AACzB,MAAMC,QAAQ,GAAGC,QAAjB;AAA2B;;AAE3B,MAAMC,2BAA2B,GAAGC,MAAM,IAAI;AAC5C;AACAC,EAAAA,OAAO,CAACC,GAAR;AACAD,EAAAA,OAAO,CAACC,GAAR,CACG;AACL,CAFE,EAGEC,IAAI,CAACC,SAAL,CAAeT,SAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAHF;AAKAM,EAAAA,OAAO,CAACC,GAAR;AACAD,EAAAA,OAAO,CAACC,GAAR,CACG;AACL,CAFE,EAGEC,IAAI,CAACC,SAAL,CAAeP,QAAf,EAAyB,IAAzB,EAA+B,CAA/B,CAHF;AAKAI,EAAAA,OAAO,CAACC,GAAR;AACAD,EAAAA,OAAO,CAACC,GAAR,CACE,uBADF,EAEEC,IAAI,CAACC,SAAL,CAAeJ,MAAM,CAACK,iBAAtB,EAAyC,IAAzC,EAA+C,CAA/C,CAFF;AAIAJ,EAAAA,OAAO,CAACC,GAAR;AAEA;AACD,CAtBD;;ACAA,MAAMP,OAAO,GAAGC,OAAhB;AAAyB;;AAClB,MAAMU,QAAQ,GAAGC,6BAAS,CAACC,iBAAV,EAAjB;;AAEP,MAAMC,cAAc,GAAG,CAACC,GAAD,EAAeL,iBAA2B,GAAG,EAA7C,KAAoD;AACzEM,EAAAA,gBAAgB,CAACL,QAAD,EAAWI,GAAX,CAAhB;AAEAA,EAAAA,GAAG,CAACE,GAAJ,CAAQP,iBAAR,EAA2B,CAACQ,GAAD,EAAMC,GAAN,KAAc;AACvC,UAAMC,MAAM,GACVF,GAAG,CAACG,QAAJ,CAAaC,OAAb,CAAqB,UAArB,KACAJ,GAAG,CAACG,QAAJ,CAAaC,OAAb,CAAqB,UAArB,CADA,IAEAJ,GAAG,CAACG,QAAJ,KAAiB,WAFjB,GAGIrB,OAAO,CAACuB,UAAR,IAAsBvB,OAAO,CAACwB,GAHlC,GAIIxB,OAAO,CAACwB,GALd;AAOAb,IAAAA,QAAQ,CAACc,GAAT,CAAaP,GAAb,EAAkBC,GAAlB,EAAuB;AAAEC,MAAAA,MAAF;AAAUM,MAAAA,YAAY,EAAE;AAAxB,KAAvB;AACAf,IAAAA,QAAQ,CAACgB,EAAT,CAAY,OAAZ,EAAqBC,CAAC,IAAI;AACxB;AACAtB,MAAAA,OAAO,CAACC,GAAR,CACG,qBAAoBW,GAAG,CAACW,IAAK,aAAYX,GAAG,CAACG,QAAS,gBAAeO,CAAE,EAD1E;AAGA;AACD,KAND;AAOD,GAhBD;AAiBD,CApBD;;AAsBA,MAAMZ,gBAAgB,GAAG,CAACL,QAAD,EAAWI,GAAX,KAAmB;AAC1C;AACAA,EAAAA,GAAG,CAACE,GAAJ,CAAQ,CAAC,iBAAD,EAAoB,cAApB,CAAR,EAA6C,CAACC,GAAD,EAAMC,GAAN,KAAc;AACzD;AACA,UAAMC,MAAM,GAAGpB,OAAO,CAAC8B,GAAvB;AACAxB,IAAAA,OAAO,CAACC,GAAR,CAAa,2BAA0BP,OAAO,CAAC+B,KAAM,EAArD;AACApB,IAAAA,QAAQ,CAACc,GAAT,CAAaP,GAAb,EAAkBC,GAAlB,EAAuB;AACrBC,MAAAA,MADqB;AAErBM,MAAAA,YAAY,EAAE;AAFO,KAAvB;AAIAf,IAAAA,QAAQ,CAACgB,EAAT,CAAY,OAAZ,EAAqBC,CAAC,IAAI;AACxB;AACAtB,MAAAA,OAAO,CAACC,GAAR,CACG,qBAAoBW,GAAG,CAACW,IAAK,aAAYX,GAAG,CAACG,QAAS,gBAAeO,CAAE,EAD1E;AAGA;AACD,KAND;AAOD,GAfD;AAgBD,CAlBD;;AC5BO,MAAMI,aAAa,GAAG;AAC3B,OAAK,MADsB;AAE3B,OAAK,GAFsB;AAG3BC,EAAAA,MAAM,EAAE,UAHmB;AAGP;AACpBC,EAAAA,aAAa,EAAE,WAJY;;AAAA,CAAtB;AAOA,MAAMC,gBAAgB,GAAG,CAACC,MAAM,GAAG,GAAV,KAAkB;AAChD,MAAIA,MAAM,GAAG,GAAb,EAAkB,OAAOJ,aAAa,CAAC,GAAD,CAApB;AAClB,SAAOA,aAAa,CAAC,GAAD,CAApB;AACD,CAHM;;ACPA,MAAMK,iBAAiB,GAAG,CAACC,GAAD,EAAcC,gBAAgB,GAAG,QAAjC,KAC/BD,GAAG,CAACE,OAAJ,CAAY,WAAZ,EAA0B,GAAED,gBAAiB,GAA7C,CADK;;ACKA,MAAME,4BAA4B,GACvC,CAAC;AACCC,EAAAA,WADD;AAECC,EAAAA,MAFD;AAGCC,EAAAA;AAHD,CAAD,KASA,CAAC1B,GAAD,EAAMC,GAAN,EAAW0B,IAAX,KAAoB;AAClB,QAAMC,QAAQ,GAAGjB,wBAAI,CAACkB,QAAL,CAAc7B,GAAG,CAACW,IAAlB,CAAjB;AACA,QAAMmB,YAAY,GAAGF,QAAQ,CAACG,QAAT,CAAkB,MAAlB,CAArB;AACA,QAAMC,YAAY,GAAGJ,QAAQ,CAACG,QAAT,CAAkB,KAAlB,CAArB;;AACA,MAAI,CAACC,YAAY,IAAIF,YAAjB,KAAkCF,QAAQ,CAACK,UAAT,CAAoB,UAApB,CAAtC,EAAuE;AACrE,UAAMC,iBAAiB,GAAGvB,wBAAI,CAACwB,OAAL,CACxBX,WADwB,EAEvB,eAAcM,YAAY,GAAG,WAAH,GAAiB,WAAY,IAAGF,QAAS,EAF5C,CAA1B;;AAIA,QAAI;AACF,YAAMQ,eAAe,GAAGC,sBAAE,CAACC,YAAH,CAAgBJ,iBAAhB,EAAmC,MAAnC,CAAxB;AACA,YAAMK,cAAc,GAAGpB,iBAAiB,CACtCiB,eADsC,EAEtCV,eAFsC,CAAxC;AAIA,UAAID,MAAJ,EAAYxB,GAAG,CAACuC,GAAJ,CAAQ,eAAR,EAA0B,mBAAkBf,MAAO,EAAnD;AACZxB,MAAAA,GAAG,CAACwC,IAAJ,CAAS,KAAT,EAAgBC,IAAhB,CAAqBH,cAArB;AACA;AACD,KATD,CASE,OAAOI,SAAP,EAAkB;AAClB;AACAvD,MAAAA,OAAO,CAACC,GAAR,CACG,wCAAuC6C,iBAAkB,GAD5D,EAEES,SAFF;AAIAhB,MAAAA,IAAI;AACL;AACF,GAtBD,MAsBO;AACLA,IAAAA,IAAI;AACL;AACF,CAvCI;;ACFP;AACA;AACA;AACA;AACA;AACA;;AACO,MAAMiB,wBAAwB,GACnC,CAAC;AACCpB,EAAAA,WADD;AAECC,EAAAA,MAFD;AAGCJ,EAAAA,gBAHD;AAICwB,EAAAA;AAJD,CAAD,KAWA,CAAC7C,GAAD,EAAMC,GAAN,EAAW0B,IAAX,KAAoB;AAClB,MACEkB,qBAAqB,KAAK,YAA1B,IACA7C,GAAG,CAACW,IAAJ,KAAc,IAAGkC,qBAAsB,EAFzC,EAGE;AACA,UAAMC,eAAe,GAAI,QAAOzB,gBAAiB,aAAjD;AACA,UAAM0B,mBAAmB,GAAGpC,wBAAI,CAACwB,OAAL,CAAaX,WAAb,EAA0BsB,eAA1B,CAA5B;AAEA,QAAIrB,MAAJ,EAAYxB,GAAG,CAACuC,GAAJ,CAAQ,eAAR,EAA0B,mBAAkBf,MAAO,EAAnD;;AAEZ,QAAI;AACFxB,MAAAA,GAAG,CAAC+C,QAAJ,CAAaD,mBAAb;AACD,KAFD,CAEE,OAAOE,aAAP,EAAsB;AACtB;AACA7D,MAAAA,OAAO,CAACC,GAAR,CACG,sCAAqC0D,mBAAoB,GAD5D,EAEEE,aAFF;AAIAtB,MAAAA,IAAI;AACL;AACF,GAnBD,MAmBO;AACLA,IAAAA,IAAI;AACL;AACF,CAnCI;;ACFP;AACA,MAAMuB,YAAY,GAAG,CACnBrD,GADmB,EAEnB;AACE2B,eAAAA,aAAW,GAAG2B,gBADhB;AAEEC,EAAAA,OAAO,GAAG,EAFZ;AAGEP,EAAAA,qBAAqB,GAAG,YAH1B;AAIExB,EAAAA,gBAAgB,GAAG,QAJrB;AAKEK,EAAAA,eAAe,GAAG,QALpB;AAME2B,EAAAA,gBAAgB,GAAG;AANrB,CAFmB,KAUhB;AACHxD,EAAAA,GAAG,CAACyD,GAAJ,CACE,CACG,IAAG5B,eAAgB,EADtB,EAEE,GAAG2B,gBAAgB,CAACE,GAAjB,CAAqBC,CAAC,IAAK,IAAGA,CAAE,EAAhC,CAFL,EAGG,IAAGnC,gBAAiB,EAHvB,CADF,EAMEE,4BAA4B,CAAC;AAC3BC,iBAAAA,aAD2B;AAE3B;AACA;AACAC,IAAAA,MAAM,EAAEX,aAAa,CAACC,MAJK;AAK3BW,IAAAA;AAL2B,GAAD,CAN9B,EAaEkB,wBAAwB,CAAC;AACvBpB,iBAAAA,aADuB;AAEvBC,IAAAA,MAAM,EAAEX,aAAa,CAACC,MAFC;AAGvB8B,IAAAA,qBAAqB,EAAEO,OAAO,CAACK,OAAR,IAAmBZ,qBAHnB;AAIvBxB,IAAAA;AAJuB,GAAD,CAb1B;AAoBEqC,EAAAA,2BAAO,CAAC3C,MAAR,CAAgB,QAAOM,gBAAiB,EAAxC,EAA2C;AACzC;AACA;AACAsC,IAAAA,MAAM,EAAE7C,aAAa,CAACE;AAHmB,GAA3C,CApBF;AA0BD,CArCD;;ACRA,2BAAe,CAAC4C,UAAU,GAAG,EAAd,KACbC,MAAM,CAACC,OAAP,CAAeF,UAAf,EACGL,GADH,CAEI,CAAC,CAACQ,GAAD,EAAMC,KAAN,CAAD,EAAeC,GAAf,KACG,GAAEA,GAAG,KAAK,CAAR,GAAY,GAAZ,GAAkB,EAAG,GAAEF,GAAI,GAAEC,KAAK,GAAI,KAAIA,KAAM,GAAd,GAAmB,EAAG,EAHjE,EAKGE,IALH,CAKQ,GALR,CADF;;ACAA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,cAAc,GAAG,CACrBC,OADqB,EAErBC,QAFqB,EAGrBC,OAHqB,EAIrB5B,IAAiC,GAAG,MAJf,KAKlB;AACH;AACA2B,EAAAA,QAAQ,CAAC3B,IAAD,CAAR,CAAe4B,OAAf;AACD,CARD;;ACLA,MAAMhC,YAAY,GAAG3B,IAAI,IAAI0B,sBAAE,CAACC,YAAH,CAAgB3B,IAAhB,EAAsB,MAAtB,CAA7B;;AAEO,MAAM4D,kBAAkB,GAAG,CAChC;AAAEC,EAAAA,KAAF;AAASC,EAAAA;AAAT,CADgC,EAEhC/C,eAFgC,EAGhCgD,KAHgC,KAI7B;AACH,QAAMC,MAOL,GAAG,EAPJ;;AAQA,MAAI;AACFA,IAAAA,MAAM,CAACH,KAAP,GAAelF,IAAI,CAACsF,KAAL,CACbtC,YAAY,CAACkC,KAAK,CAAClD,OAAN,CAAc,SAAd,EAAyBoD,KAAK,GAAI,IAAGA,KAAM,EAAb,GAAiB,EAA/C,CAAD,CADC,CAAf;AAGD,GAJD,CAIE,OAAOG,EAAP,EAAW;AACX;AACAF,IAAAA,MAAM,CAACH,KAAP,GAAe,IAAf;AACD;;AACD,MAAI;AACFG,IAAAA,MAAM,CAACF,SAAP,GAAmB;AACjBK,MAAAA,YAAY,EAAE3D,iBAAiB,CAC7BmB,YAAY,CACVmC,SAAS,CAACM,IAAV,CAAezD,OAAf,CAAuB,SAAvB,EAAkCoD,KAAK,GAAI,IAAGA,KAAM,EAAb,GAAiB,EAAxD,CADU,CADiB,EAI7BhD,eAJ6B,CADd;AAOjBsD,MAAAA,kBAAkB,EAAE7D,iBAAiB,CACnCmB,YAAY,CACVmC,SAAS,CAAC1D,MAAV,CAAiBO,OAAjB,CAAyB,SAAzB,EAAoCoD,KAAK,GAAI,IAAGA,KAAM,EAAb,GAAiB,EAA1D,CADU,CADuB,EAInChD,eAJmC,CAPpB;AAajBuD,MAAAA,oBAAoB,EAAE9D,iBAAiB,CACrCmB,YAAY,CACVmC,SAAS,CAACS,QAAV,CAAmB5D,OAAnB,CAA2B,SAA3B,EAAsCoD,KAAK,GAAI,IAAGA,KAAM,EAAb,GAAiB,EAA5D,CADU,CADyB,EAIrChD,eAJqC;AAbtB,KAAnB;AAoBD,GArBD,CAqBE,OAAOmD,EAAP,EAAW;AACX;AACAF,IAAAA,MAAM,CAACF,SAAP,GAAmB,IAAnB;AACD;;AACD,SAAOE,MAAP;AACD,CA/CM;AAyDA,MAAMQ,uBAAuB,GAAG,MAAM;AAC3C,MAAI;AACF,UAAMC,MAAM,GAAG,IAAIC,qBAAJ,CAAmB;AAChCC,MAAAA,WAAW,EAAE,CAAC,KAAD,CADmB;AAEhCC,MAAAA,SAAS,EAAE,QAFqB;AAGhCC,MAAAA,SAAS,EAAE7E,wBAAI,CAACwB,OAAL,CAAa,iCAAb;AAHqB,KAAnB,CAAf;AAKA,UAAMsD,MAAM,GAAG,IAAIJ,qBAAJ,CAAmB;AAChCC,MAAAA,WAAW,EAAE,CAAC,KAAD,CADmB;AAEhCC,MAAAA,SAAS,EAAE,QAFqB;AAGhCC,MAAAA,SAAS,EAAE7E,wBAAI,CAACwB,OAAL,CAAa,iCAAb;AAHqB,KAAnB,CAAf;AAKA,UAAMuD,uBAAuC,GAAG;AAC9CC,MAAAA,QAAQ,CAACC,KAAD,EAAQ;AACdR,QAAAA,MAAM,CAACO,QAAP,CAAgBC,KAAhB;AACA,YAAI,OAAOH,MAAM,CAACjB,KAAP,CAAaqB,iBAAb,CAA+BD,KAA/B,CAAP,KAAiD,WAArD,EACEH,MAAM,CAACE,QAAP,CAAgBC,KAAhB;AACH;;AAL6C,KAAhD;AAQA,WAAO;AACLF,MAAAA,uBADK;AAELN,MAAAA,MAFK;AAGLK,MAAAA;AAHK,KAAP;AAKD,GAxBD,CAwBE,OAAO/E,CAAP,EAAU;AACVtB,IAAAA,OAAO,CAAC0G,IAAR,CAAa,+CAAb;AACD;AACF,CA5BM;AA8BA,MAAMC,aAAa,GAAG,CAAC5G,MAAD,EAASuC,eAAT,KAA6B;AACxD,QAAMsE,UAAU,GAAG;AACjBC,IAAAA,OAAO,EAAE1B,kBAAkB,CAACpF,MAAD,EAASuC,eAAT,CADV;AAEjB+D,IAAAA,MAAM,EAAElB,kBAAkB,CAACpF,MAAD,EAASuC,eAAT,EAA0B,QAA1B,CAFT;AAGjB0D,IAAAA,MAAM,EAAEb,kBAAkB,CAACpF,MAAD,EAASuC,eAAT,EAA0B,QAA1B;AAHT,GAAnB;AAKA,MAAI,CAACsE,UAAU,CAACC,OAAZ,IAAuBD,UAAU,CAACC,OAAX,KAAuB,EAAlD,EACED,UAAU,CAACC,OAAX,GAAqBD,UAAU,CAACP,MAAX,IAAqBO,UAAU,CAACZ,MAArD;AACF,SAAOY,UAAP;AACD,CATM;AAwCA,MAAME,aAAa,GAAG,CAC3BC,iBAD2B,EAE3B/C,OAF2B,EAG3B1B,eAAe,GAAG,QAHS,KAIxB;AACH,MAAI0E,UAAU,GAAG,EAAjB,CADG;;AAGH,MAAIhD,OAAJ,aAAIA,OAAJ,eAAIA,OAAO,CAAEK,OAAb,EACE2C,UAAU,GAAI,WAAUC,mBAAmB,CACzCjD,OAAO,CAACQ,UADiC,CAEzC,UAASlC,eAAgB,IAAG0B,OAAO,CAACK,OAAQ,aAF9C,CAJC;;AASH,MAAI0C,iBAAJ,EAAuB;AACrB,UAAMG,gBAAgB,GAAGH,iBAAH,aAAGA,iBAAH,uBAAGA,iBAAiB,CAAEV,MAAnB,CAA0Bc,aAA1B,CAAwC;AAC/DC,MAAAA,QAAQ,EAAE;AADqD,KAAxC,CAAzB;AAGA,UAAMC,gBAAgB,GAAGN,iBAAH,aAAGA,iBAAH,uBAAGA,iBAAiB,CAAEf,MAAnB,CAA0BmB,aAA1B,CAAwC;AAC/D9D,MAAAA,IAAI,EAAE;AADyD,KAAxC,CAAzB;AAGA,WAAQ,GAAE2D,UAAW,GAAEE,gBAAgB,IAAI,EAAG,GAAEG,gBAAgB,IAAI,EAAG,EAAvE;AACD;;AACD,SAAOL,UAAP;AACD,CAvBM;;AC/HA,MAAMM,kBAAkB,GAAG,CAChCC,KADgC,EAEhCtC,QAFgC,EAGhCuC,WAHgC,EAIhCC,MAJgC,KAK7B;AACH,MAAIF,KAAJ,EAAW;AACT,QAAI;AACFvH,MAAAA,OAAO,CAAC0G,IAAR,CAAa,sBAAb;AACA,YAAMgB,oBAAoB,GAAGC,0BAAK,CAChCJ,KADgC,EAEhC,CAAC,SAAD,EAAY,eAAZ,CAFgC,EAGhC,EAHgC,CAAlC;AAMA,YAAMK,kBAAkB,GAAI,IAAGJ,WAAW,CAACK,IAAK,QAAOH,oBAAqB,EAA5E;AAEAzC,MAAAA,QAAQ,CAAC6C,MAAT,CAAgB,eAAhB,EAAiCF,kBAAjC;AAEAG,MAAAA,+BAA+B,CAACR,KAAD,EAAQtC,QAAR,EAAkBwC,MAAlB,CAA/B;AAEAxC,MAAAA,QAAQ,CAAC+C,SAAT,CACE,mBADF,EAEG,WAAUnG,gBAAgB,CAACoD,QAAQ,CAACgD,UAAV,CAAsB,EAFnD;AAID,KAlBD,CAkBE,OAAO3G,CAAP,EAAe;AACftB,MAAAA,OAAO,CAAC0G,IAAR,CAAa,sBAAb,EAAqCpF,CAAC,CAAC4G,OAAvC;AACD;AACF;AACF,CA7BM;AA+BA,MAAMH,+BAA+B,GAAG,CAC7CR,KAD6C,EAE7CtC,QAF6C,EAG7CwC,MAAuD,GAAG,EAHb,KAI1C;AACH,MAAIF,KAAJ,EAAW;AACT,QAAI;AACF,YAAMY,UAAU,GAAGC,0BAAgB,CAACb,KAAD,CAAnC;AACA,YAAMc,OAAO,GAAGC,8BAAoB,CAACf,KAAD,CAApC;AACA,YAAM;AAAEgB,QAAAA,YAAF;AAAgBC,QAAAA;AAAhB,UAAkCf,MAAxC,CAHE;;AAKF,UAAIgB,SAAS,GAAGC,KAAK,CAACC,IAAN,CAAYJ,YAAY,IAAIA,YAAY,CAACF,OAAD,CAA7B,IAA2C,EAAtD,CAAhB;;AACA,UACEF,UAAU,IACVR,0BAAK,CAACQ,UAAD,EAAa,CAAC,gBAAD,EAAmB,iBAAnB,CAAb,CADL,IAEAK,aAFA,IAGAA,aAAa,CAACH,OAAD,CAJf,EAKE;AACAI,QAAAA,SAAS,GAAG,CAAC,GAAGA,SAAJ,EAAe,GAAGD,aAAa,CAACH,OAAD,CAA/B,CAAZ;AACD;;AACDpD,MAAAA,QAAQ,CAAC6C,MAAT,CAAgB,2BAAhB,EAA6CW,SAAS,CAAC3D,IAAV,CAAe,GAAf,CAA7C;AACD,KAfD,CAeE,OAAOxD,CAAP,EAAU;AACVtB,MAAAA,OAAO,CAAC0G,IAAR,CAAa,oCAAb,EAAmDpF,CAAnD;AACD;AACF;AACF,CAzBM;;ACDP,MAAMsH,MAAM,GAAG,CACbnI,GADa,EAEboI,QAFa,EAGb9I,MAHa,KAQV;AACH,QAAM;AACJ+I,IAAAA,SAAS,GAAG,WADR;AAEJC,IAAAA,MAFI;AAGJC,IAAAA,YAHI;AAIJC,IAAAA,SAJI;AAKJC,IAAAA,UALI;AAMJ1B,IAAAA,WANI;AAOJxD,IAAAA,OAAO,GAAG,EAPN;AAQJ/B,IAAAA,gBAAgB,GAAG,QARf;AASJwB,IAAAA,qBATI;AAUJ+E,IAAAA,aAVI;AAWJD,IAAAA,YAXI;AAYJY,IAAAA,eAZI;AAaJC,IAAAA;AAbI,MAcFrJ,MAdJ;AAeA,QAAMuC,eAAe,GAAGvC,MAAM,CAACuC,eAAP,IAA0BL,gBAAlD;AAEA,QAAM2E,UAAU,GAAGD,aAAa,CAAC5G,MAAD,EAASuC,eAAT,CAAhC;AAEA,QAAMkC,UAAU,GAAGyC,mBAAmB,CAACjD,OAAO,CAACQ,UAAT,CAAtC;AACAR,EAAAA,OAAO,CAACK,OAAR,GAAkBL,OAAO,CAACK,OAAR,IAAmBZ,qBAArC;AAEA,QAAM4F,eAAe,GACnB,OAAOD,eAAP,KAA2B,UAA3B,GAAwCA,eAAxC,GAA0DrE,cAD5D;AAGA,QAAMuE,WAAW,GAAGpJ,IAAI,CAACsF,KAAL,CAClBvC,sBAAE,CAACC,YAAH,CAAiB,QAAOjB,gBAAiB,eAAzC,EAAyD,MAAzD,CADkB,CAApB;AAIAxB,EAAAA,GAAG,CAAC8I,GAAJ,CAAQ,IAAR,EAAc,OAAOvE,OAAP,EAAgBC,QAAhB,KAA6B;AACzC,UAAM;AAAEuE,MAAAA;AAAF,QAAUxE,OAAhB;;AAEA,UAAMyE,kBAAkB,GAAG,MACzBC,6BAAW,CAACX,MAAM,CAACY,YAAR,EAAsB3E,OAAO,CAACzD,IAA9B,CADb;;AAEA,UAAMqI,aAAa,GAAG,MAAMH,kBAAkB,GAAGI,MAArB,GAA8B,CAA1D;;AACA,UAAMC,WAAW,GAAGF,aAAa,MAAMH,kBAAkB,GAAG,CAAH,CAAzD,CANyC;;AASzC,UAAMM,WAAW,GAAGD,WAAW,IAAIA,WAAW,CAACE,KAAZ,CAAkBC,GAAlB,KAA0B,KAA7D;AACA,UAAMC,OAAO,GAAGJ,WAAW,IAAIA,WAAW,CAACE,KAAZ,CAAkBG,OAAlB,KAA8B,IAA7D;;AAEA,UAAMC,WAAW,GAAGC,CAAC,IAAKA,CAAC,IAAIA,CAAC,CAACC,WAAF,OAAoB,MAAzB,GAAkC,IAAlC,GAAyC,KAAnE,CAZyC;;;AAezC,UAAMC,YAAY,GAAGC,2BAAO,CAG1BxF,OAAO,CAACyF,KAHkB,EAGX;AACfC,MAAAA,OAAO,EAAE,CAAC;AAAEC,QAAAA;AAAF,OAAD,KAAiBP,WAAW,CAACO,OAAD,CAAX,IAAwBZ,WADnC;AAEfa,MAAAA,KAAK,EAAE,CAAC;AAAEC,QAAAA;AAAF,OAAD,KAAeT,WAAW,CAACS,KAAD,CAFlB;AAGfC,MAAAA,QAAQ,EAAE,CAAC;AAAEhF,QAAAA;AAAF,OAAD,KAAkBsE,WAAW,CAACtE,QAAD,CAHxB;AAIfiF,MAAAA,MAAM,EAAE,CAAC;AAAEpJ,QAAAA,MAAM,EAAEiD;AAAV,OAAD,KAAuBwF,WAAW,CAACxF,KAAD,CAAX,IAAsBsF;AAJtC,KAHW,CAA5B;AAUA,UAAMc,OAA4B,GAAG,EAArC,CAzByC;;AA2BzC/F,IAAAA,QAAQ,CAACnD,MAAT,CAAgB,GAAhB,EA3ByC;;AA8BzC,UAAMmJ,KAAK,GAAG,MAAMC,mBAAW,CAC7BlC,YAD6B,EAE7B,EAF6B,EAG7BmC,WAAO,CAAC;AACNC,MAAAA,cAAc,EAAE,CAAC5B,GAAD;AADV,KAAD,CAHsB,EAM7BV,SAN6B,CAA/B,CA9ByC;;AAwCzC,UAAMuC,yBAAyB,GAAGC,eAAW,CAACC,4BAAZ,CAChCvG,OAAO,CAACjE,QADwB,CAAlC;AAIAf,IAAAA,OAAO,CAAC0G,IAAR,CACG,eAAc1B,OAAO,CAACzD,IAAK,cAAayD,OAAO,CAACjE,QAAS,mBAAkBsK,yBAA0B,EADxG;AAIAJ,IAAAA,KAAK,CAACO,QAAN,CACEC,wBAAgB,CAACzG,OAAO,CAACyF,KAAR,CAAciB,aAAd,IAA+BL,yBAAhC,CADlB;AAGAJ,IAAAA,KAAK,CAACO,QAAN,CAAeG,kBAAU,CAACrC,WAAW,CAACsC,SAAb,EAAwBtC,WAAW,CAACuC,OAApC,CAAzB;AAEA,UAAMxD,OAAO,GAAGyD,eAAW,CAAC9G,OAAO,CAACjE,QAAT,EAAmBiE,OAAO,CAACyF,KAA3B,CAA3B;AAEA,UAAMhD,MAAM,GAAGe,aAAa,IAAIA,aAAa,CAACH,OAAD,CAA7C;AACA4C,IAAAA,KAAK,CAACO,QAAN,CAAeO,yBAAiB,CAAC1D,OAAD,EAAUZ,MAAV,EAAkBzC,OAAO,CAACjE,QAA1B,CAAhC;AAEA,UAAMgG,iBAAiB,GAAGhB,uBAAuB,EAAjD;AAEA,UAAMiG,GAAG,gBACPC,wCAACC,4BAAD;AACE,MAAA,SAAS,EAAEnF,iBAAF,aAAEA,iBAAF,uBAAEA,iBAAiB,CAAET;AADhC,oBAGE2F,wCAACE,mBAAD;AAAe,MAAA,KAAK,EAAElB;AAAtB,oBACEgB,wCAACG,2BAAD;AAAc,MAAA,OAAO,EAAEpB,OAAvB;AAAgC,MAAA,QAAQ,EAAExB;AAA1C,oBACEyC,wCAAC,QAAD;AAAU,MAAA,MAAM,EAAElD,MAAlB;AAA0B,MAAA,UAAU,EAAEG;AAAtC,MADF,CADF,CAHF,CADF;AAYA,UAAM;AAAExD,MAAAA,YAAF;AAAgBG,MAAAA,oBAAhB;AAAsCD,MAAAA;AAAtC,QACJgB,UAAU,CAACC,OAAX,CAAmBxB,SAAnB,IAAgCuB,UAAU,CAACP,MAAX,CAAkBhB,SAAlD,IAA+D,EADjE,CAxEyC;;AA4EzC,QAAIkF,YAAY,CAACG,OAAjB,EAA0B;AACxB;AACA2B,MAAAA,uBAAc,CAACL,GAAD,CAAd,CAFwB;AAKxB;;AACA,YAAMM,UAAU,GAAGxF,aAAa,CAACC,iBAAD,EAAoB/C,OAApB,CAAhC;AAEA,YAAMuI,aAAa,GAAI,WAAU/H,UAAW,oCAA5C;AAEA,YAAMgI,mBAAmB,GAAG9G,YAAY,CACrCxD,OADyB,CACjB,WADiB,EACJ,EADI,EAEzBA,OAFyB,CAEjB,2BAFiB,EAEY,EAFZ,EAGzBA,OAHyB,CAGjB,kBAHiB,EAGG,EAHH,EAIzBA,OAJyB,CAIjB,SAJiB,EAIN,EAJM,EAKzBA,OALyB,CAKjB,qBALiB,EAKMoK,UALN,EAMzBpK,OANyB,CAMjB,gBANiB,EAMCqK,aAND,CAA5B,CAVwB;AAkBxB;;AACAtH,MAAAA,QAAQ,CAAC+C,SAAT,CACE,mBADF,EAEG,WAAUnG,gBAAgB,CAAC,GAAD,CAAM,EAFnC;AAIAwH,MAAAA,eAAe,CAACrE,OAAD,EAAUC,QAAV,EAAoBuH,mBAApB,CAAf;AACD,KApGwC;;;AAuGzC,QAAI,CAACjC,YAAY,CAACG,OAAlB,EAA2B;AACzBO,MAAAA,KAAK,CACFwB,OADH,CACWC,YAAQ,CAACzD,SAAD,CADnB,EAEG0D,SAFH,GAGGC,IAHH,CAGQ,MAAM;AACV,cAAMC,KAAK,GAAG,IAAIC,uBAAJ,EAAd;AAEA,cAAMnH,IAAI,GAAG0G,uBAAc,CAACQ,KAAK,CAACE,aAAN,CAAoBf,GAApB,CAAD,CAA3B;AAEA,cAAMgB,MAAM,GAAGC,0BAAM,CAACC,YAAP,EAAf;AACAD,QAAAA,0BAAM,CAACE,MAAP;AACA,cAAMC,cAAc,GAAGJ,MAAM,CAACI,cAAP,CAAsBC,QAAtB,EAAvB;AACA,YAAIC,KAAK,GAAGN,MAAM,CAACM,KAAP,CAAaD,QAAb,EAAZ;AACA,cAAME,QAAQ,GAAGP,MAAM,CAACQ,IAAP,CAAYH,QAAZ,EAAjB;;AAEA,YAAIrC,OAAO,CAACxB,GAAZ,EAAiB;AACf,iBAAOvE,QAAQ,CAACwI,QAAT,CAAkB,GAAlB,EAAuBzC,OAAO,CAACxB,GAA/B,CAAP;AACD;;AAED,cAAMkE,UAAU,GAAGzC,KAAK,CAAC0C,QAAN,EAAnB;AAEA,cAAMC,SAAS,GAAGf,KAAK,CAACgB,YAAN,EAAlB,CAjBU;AAoBV;;AACA,cAAMvB,UAAU,GAAGxF,aAAa,CAACC,iBAAD,EAAoB/C,OAApB,CAAhC;AAEA,YAAI8J,mBAAmB,GAAG,EAA1B;;AACA,YAAI9C,OAAO,CAAC/C,UAAR,KAAuB,GAA3B,EAAgC;AAC9B;AACA,cAAIsC,YAAY,CAACK,KAAjB,EAAwB;AACtBkD,YAAAA,mBAAmB,GAAGC,6BAAS,CAACL,UAAD,EAAa;AAC1CM,cAAAA,cAAc,EAAE;AAD0B,aAAb,CAA/B;AAGA1G,YAAAA,kBAAkB,CAACoG,UAAD,EAAazI,QAAb,EAAuBuC,WAAvB,EAAoC;AACpDgB,cAAAA,aADoD;AAEpDD,cAAAA;AAFoD,aAApC,CAAlB;AAIAc,YAAAA,eAAe,CAACrE,OAAD,EAAUC,QAAV,EAAoB6I,mBAApB,EAAyC,MAAzC,CAAf;AACA,mBAAO,IAAP;AACD;;AACD,cAAI,CAAC3E,eAAL,EAAsB;AACpB2E,YAAAA,mBAAmB,GAAGC,6BAAS,CAACL,UAAD,EAAa;AAC1CM,cAAAA,cAAc,EAAE;AAD0B,aAAb,CAA/B;AAGAF,YAAAA,mBAAmB,GAAI,WAAUtJ,UAAW,wBAAuBsJ,mBAAoB,WAAvF;AACD;AACF;;AACD,YAAI,CAAC9C,OAAO,CAAC/C,UAAR,IAAsB,GAAvB,IAA8B,GAAlC,EAAuC;AACrCsC,UAAAA,YAAY,CAACQ,MAAb,GAAsB,IAAtB;AACD,SA9CS;;;AAiDV,YAAIkD,YAAY,GAAG,EAAnB;AAEA,YAAIjD,OAAO,CAAC/C,UAAR,KAAuB,GAA3B,EACEqF,KAAK,GAAG,mCAAR,CApDQ;;AAuDV,YAAI/C,YAAY,CAACO,QAAb,IAAyBP,YAAY,CAACQ,MAA1C,EAAkD;AAChDkD,UAAAA,YAAY,GAAGC,mCAAe,CAACN,SAAD,CAAf,GAA6BjI,IAA5C;AACD,SAzDS;;;AA4DV,YAAI4E,YAAY,CAACO,QAAb,IAAyB,CAACP,YAAY,CAACQ,MAA3C,EAAmD;AACjDkD,UAAAA,YAAY,GAAGpI,oBAAoB,CAChC3D,OADY,CACJ,WADI,EACSoL,KADT,EAEZpL,OAFY,CAEJ,2BAFI,EAEyBqL,QAFzB,EAGZrL,OAHY,CAGJ,kBAHI,EAGgBgM,mCAAe,CAACN,SAAD,CAH/B,EAIZ1L,OAJY,CAIJ,SAJI,EAIOyD,IAJP,EAKZzD,OALY,CAKJ,qBALI,EAKmBoK,UALnB,EAMZpK,OANY,CAMJ,gBANI,EAMc4L,mBANd,CAAf;AAOD,SApES;;;AAuEV,YAAI,CAACvD,YAAY,CAACO,QAAd,IAA0BP,YAAY,CAACQ,MAA3C,EAAmD;AACjDkD,UAAAA,YAAY,GAAGrI,kBAAkB,CAC9B1D,OADY,CACJ,WADI,EACSoL,KADT,EAEZpL,OAFY,CAEJ,2BAFI,EAEyBqL,QAFzB,EAGZrL,OAHY,CAGJ,kBAHI,EAGgBgM,mCAAe,CAACN,SAAD,CAH/B,EAIZ1L,OAJY,CAIJ,SAJI,EAIOyD,IAJP,EAKZzD,OALY,CAKJ,qBALI,EAKmB,EALnB,CAAf;AAMD,SA9ES;;;AAiFV,YAAI,CAACqI,YAAY,CAACO,QAAd,IAA0B,CAACP,YAAY,CAACQ,MAA5C,EAAoD;AAClDkD,UAAAA,YAAY,GAAGvI,YAAY,CACxBxD,OADY,CACJ,WADI,EACSoL,KADT,EAEZpL,OAFY,CAEJ,2BAFI,EAEyBqL,QAFzB,EAGZrL,OAHY,CAGJ,kBAHI,EAGgB0L,SAHhB,EAIZ1L,OAJY,CAIJ,SAJI,EAIOyD,IAJP,EAKZzD,OALY,CAKJ,qBALI,EAKmBoK,UALnB,EAMZpK,OANY,CAMJ,gBANI,EAMc4L,mBANd,CAAf;AAOD,SAzFS;;;AA4FV,YAAI,OAAO9C,OAAO,CAAC/C,UAAf,KAA8B,QAAlC,EACEhD,QAAQ,CAACnD,MAAT,CAAgBkJ,OAAO,CAAC/C,UAAxB;AAEFX,QAAAA,kBAAkB,CAACoG,UAAD,EAAazI,QAAb,EAAuBuC,WAAvB,EAAoC;AACpDgB,UAAAA,aADoD;AAEpDD,UAAAA;AAFoD,SAApC,CAAlB;;AAIA,YAAI;AACF;AACA;AACA;AACA,cAAI6E,cAAJ,EAAoB;AAClBa,YAAAA,YAAY,GAAGA,YAAY,CAAC/L,OAAb,CACb,YADa,EAEZ,SAAQkL,cAAe,GAFX,CAAf;AAID;;AACD/D,UAAAA,eAAe,CAACrE,OAAD,EAAUC,QAAV,EAAoBgJ,YAApB,CAAf;AACD,SAXD,CAWE,OAAOE,GAAP,EAAiB;AACjBnO,UAAAA,OAAO,CAAC0G,IAAR,CAAayH,GAAG,CAACjG,OAAjB;AACD;AACF,OApHH,EAqHGkG,KArHH,CAqHSD,GAAG,IAAI;AACZ;AACA;AACAnO,QAAAA,OAAO,CAAC0G,IAAR,CAAayH,GAAb;AACAlJ,QAAAA,QAAQ,CAACnD,MAAT,CAAgB,GAAhB;AACAuH,QAAAA,eAAe,CACbrE,OADa,EAEbC,QAFa,EAGZ,yBAAwBkJ,GAAG,CAACE,KAAM,UAASnO,IAAI,CAACC,SAAL,CAAegO,GAAf,CAAoB,EAHnD,CAAf;AAKD,OA/HH;AAgIA9B,MAAAA,uBAAc,CAACL,GAAD,CAAd;AAEAf,MAAAA,KAAK,CAACqD,KAAN;AACD;AACF,GA5OD;AA6OD,CAnRD;;ACrBA,MAAM7N,GAAY,GAAG6D,2BAAO,EAA5B;;AAEA,MAAMiK,KAAK,GAAG,CACZ1F,QADY,EAEZ9I,MAFY,EAGZyO,cAHY,KAIT;AACHC,EAAAA,MAAM,CAACC,YAAP,GAAsB3O,MAAM,CAACyH,WAA7B;AACAiH,EAAAA,MAAM,CAACE,iBAAP,GAA2B5O,MAAM,CAACoJ,eAAlC;AACAsF,EAAAA,MAAM,CAACG,kBAAP,GAA4B7O,MAAM,CAAC8O,gBAAnC;AACAJ,EAAAA,MAAM,CAACK,mBAAP,GAA6BrK,MAAM,CAAC1E,MAAM,CAACK,iBAAR,CAAnC;AAEAK,EAAAA,GAAG,CAACsO,OAAJ,CAAY,cAAZ,EANG;;AASHjP,EAAAA,2BAA2B,CAACC,MAAD,CAA3B;AAEAyO,EAAAA,cAAc,CAAC/N,GAAD,CAAd,CAXG;AAaH;;AACAuO,EAAAA,cAAuB,CAACvO,GAAD,EAAMV,MAAM,CAACK,iBAAb,CAAvB;AACA6O,EAAAA,YAAiB,CAACxO,GAAD,EAAMV,MAAN,CAAjB;AACAmP,EAAAA,MAAe,CAACzO,GAAD,EAAMoI,QAAN,EAAgB9I,MAAhB,CAAf;AAEAU,EAAAA,GAAG,CAACY,EAAJ,CAAO,OAAP,EAAgB,YAAY;AAC1B;AACA;AAEA8N,IAAAA,4BAAQ,CAACC,UAAT,GAAsBxC,IAAtB,CAA2B,MAAM;AAC/B,YAAMyC,MAAM,GAAG5O,GAAG,CAAC6O,MAAJ,CAAW,IAAX,EAAiB,MAAM;AACpCtP,QAAAA,OAAO,CAAC0G,IAAR,CAAc,sCAAd;AACA6I,QAAAA,UAAU,CAAC,YAAY;AACrB9O,UAAAA,GAAG,CAAC+O,IAAJ,CAAS,aAAT;AACD,SAFS,EAEP,GAFO,CAAV;AAGD,OALc,CAAf;AAMA/O,MAAAA,GAAG,CAACY,EAAJ,CAAO,MAAP,EAAe,MAAM;AACnBgO,QAAAA,MAAM,CAACf,KAAP,CAAa,YAAY;AACvBtO,UAAAA,OAAO,CAAC0G,IAAR,CAAa,YAAb;AACD,SAFD;AAGD,OAJD;AAKD,KAZD;AAaD,GAjBD;AAkBD,CAxCD;;AA0CA,qBAAe;AAAEjG,EAAAA,GAAF;AAAOJ,EAAAA,QAAP;AAAiBkO,EAAAA;AAAjB,CAAf;;;;;"
}
